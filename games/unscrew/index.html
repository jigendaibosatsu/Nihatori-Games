<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>ネジ外し – Nihatori Games</title>
  <link rel="stylesheet" href="/styles.css" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body.game-page {
      padding-top: 48px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: "MS PGothic", "Yu Gothic", sans-serif;
      background: linear-gradient(180deg, #1c1917 0%, #292524 50%, #1c1917 100%);
      color: #e7e5e4;
    }
    .us-wrap {
      width: 100%;
      max-width: 360px;
      padding: 12px;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .us-title {
      font-size: 1.1rem;
      text-align: center;
      font-weight: bold;
      color: #a8a29e;
    }
    .us-sub {
      font-size: 11px;
      text-align: center;
      color: #78716c;
      line-height: 1.5;
      margin-bottom: 4px;
    }
    .us-panel {
      flex: 1;
      min-height: 200px;
      border-radius: 12px;
      border: 3px solid #57534e;
      background: linear-gradient(180deg, #44403c 0%, #292524 100%);
      padding: 12px;
      display: flex;
      flex-wrap: wrap;
      align-content: flex-start;
      justify-content: center;
      gap: 12px;
      position: relative;
    }
    .us-screw {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(145deg, #78716c 0%, #57534e 50%, #44403c 100%);
      border: 2px solid #a8a29e;
      box-shadow: inset 0 2px 4px rgba(255,255,255,0.1), 0 2px 6px rgba(0,0,0,0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      transition: transform 0.05s ease-out;
      position: relative;
    }
    .us-screw.removed {
      pointer-events: none;
      opacity: 0;
      transform: scale(0.3);
      transition: opacity 0.3s, transform 0.3s;
    }
    .us-screw:active:not(.removed) {
      transform: rotate(45deg) scale(0.98);
    }
    .us-screw-head {
      width: 24px;
      height: 24px;
      background: linear-gradient(180deg, #d6d3d1 0%, #a8a29e 100%);
      border-radius: 2px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.5), 0 1px 2px rgba(0,0,0,0.3);
    }
    .us-screw-head.cross {
      background: transparent;
      position: relative;
    }
    .us-screw-head.cross::before,
    .us-screw-head.cross::after {
      content: "";
      position: absolute;
      background: linear-gradient(180deg, #d6d3d1 0%, #a8a29e 100%);
      border-radius: 1px;
    }
    .us-screw-head.cross::before {
      left: 50%;
      top: 2px;
      width: 4px;
      height: 20px;
      margin-left: -2px;
    }
    .us-screw-head.cross::after {
      top: 50%;
      left: 2px;
      width: 20px;
      height: 4px;
      margin-top: -2px;
    }
    .us-progress {
      position: absolute;
      bottom: 2px;
      left: 4px;
      right: 4px;
      height: 3px;
      background: #1c1917;
      border-radius: 2px;
      overflow: hidden;
    }
    .us-progress-fill {
      height: 100%;
      width: 0%;
      background: #22c55e;
      border-radius: 2px;
      transition: width 0.15s;
    }
    .us-status {
      font-size: 12px;
      text-align: center;
      color: #a8a29e;
    }
    .us-done {
      font-size: 14px;
      font-weight: bold;
      color: #22c55e;
      text-align: center;
      padding: 10px;
      border-radius: 8px;
      background: rgba(34,197,94,0.15);
      border: 2px solid #22c55e;
      display: none;
    }
    .us-done.visible { display: block; }
    .us-again {
      display: inline-block;
      margin-top: 8px;
      padding: 8px 16px;
      border-radius: 8px;
      border: 2px solid #78716c;
      background: #57534e;
      color: #e7e5e4;
      font-size: 13px;
      font-weight: bold;
      cursor: pointer;
    }
    .us-back {
      display: inline-block;
      margin-top: 8px;
      font-size: 12px;
      color: #a8a29e;
      text-decoration: none;
    }
  </style>
</head>
<body class="game-page">
  <div id="site-header"></div>

  <div class="us-wrap">
    <h1 class="us-title">ネジ外し</h1>
    <p class="us-sub">
      ネジをタップして回し、全部外そう。<br />
      気持ちいいネジ外しゲーム。
    </p>

    <div class="us-panel" id="usPanel"></div>

    <div class="us-status" id="usStatus">残り 12 本</div>

    <div class="us-done" id="usDone">
      全部外した！
      <button type="button" class="us-again" id="usAgain">もう一度やる</button>
    </div>

    <a href="/index.html" class="us-back">← トップへ戻る</a>
  </div>

  <script src="/assets/header.js"></script>
  <script>
(function () {
  'use strict';

  var ROWS = 3;
  var COLS = 4;
  var TURNS_PER_SCREW = 8;

  var state = {
    screws: [],
    total: 0,
    removed: 0
  };

  function $(id) { return document.getElementById(id); }

  function init() {
    state.screws = [];
    state.removed = 0;
    state.total = ROWS * COLS;
    var panel = $('usPanel');
    panel.innerHTML = '';
    for (var i = 0; i < state.total; i++) {
      var screw = {
        id: i,
        turns: 0,
        removed: false
      };
      state.screws.push(screw);
      var el = document.createElement('div');
      el.className = 'us-screw' + (Math.random() < 0.5 ? '' : '');
      el.dataset.id = String(i);
      var head = document.createElement('div');
      head.className = 'us-screw-head ' + (Math.random() < 0.5 ? 'cross' : '');
      el.appendChild(head);
      var progressWrap = document.createElement('div');
      progressWrap.className = 'us-progress';
      var progressFill = document.createElement('div');
      progressFill.className = 'us-progress-fill';
      progressFill.dataset.id = String(i);
      progressWrap.appendChild(progressFill);
      el.appendChild(progressWrap);
      el.addEventListener('click', function (e) {
        var id = parseInt(this.dataset.id, 10);
        turnScrew(id);
      });
      panel.appendChild(el);
    }
    $('usStatus').textContent = '残り ' + state.total + ' 本';
    $('usDone').classList.remove('visible');
  }

  function turnScrew(id) {
    var screw = state.screws[id];
    if (!screw || screw.removed) return;
    screw.turns++;
    var panel = $('usPanel');
    var el = panel.children[id];
    var fill = el.querySelector('.us-progress-fill');
    if (fill) fill.style.width = (screw.turns / TURNS_PER_SCREW * 100) + '%';
    el.style.transform = 'rotate(' + (screw.turns * 45) + 'deg)';
    if (screw.turns >= TURNS_PER_SCREW) {
      screw.removed = true;
      state.removed++;
      el.style.transform = '';
      el.classList.add('removed');
      $('usStatus').textContent = '残り ' + (state.total - state.removed) + ' 本';
      if (state.removed >= state.total) {
        $('usDone').classList.add('visible');
      }
    }
  }

  function reset() {
    init();
  }

  $('usAgain').addEventListener('click', reset);
  init();
})();
  </script>
</body>
</html>
