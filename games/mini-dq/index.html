<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>小さな冒険 – Nihatori Games</title>
  <link rel="stylesheet" href="/styles.css" />
  <style>
    * { box-sizing: border-box; }
    html { height: 100%; }
    body.game-page {
      margin: 0;
      padding-top: 48px;
      background: linear-gradient(180deg, #2d5016 0%, #1a3009 100%);
      min-height: 100vh;
      min-height: 100dvh;
      font-family: "MS PGothic", "Yu Gothic", sans-serif;
      color: #fff;
    }
    .rpg-container {
      max-width: 400px;
      margin: 0 auto;
      padding: 16px;
    }
    .rpg-title { font-size: 1.25rem; text-align: center; margin: 0 0 24px; }
    .rpg-screen { display: none; }
    .rpg-screen.visible { display: block; }
    .rpg-box {
      background: rgba(0,0,0,0.4);
      border: 3px solid #8b7355;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }
    .rpg-msg { margin: 0 0 16px; line-height: 1.6; font-size: 15px; }
    .rpg-btn {
      display: block;
      width: 100%;
      max-width: 280px;
      margin: 0 auto 10px;
      padding: 12px 20px;
      font-size: 1rem;
      font-weight: bold;
      color: #fff;
      background: linear-gradient(180deg, #8b4513 0%, #5d2e0c 100%);
      border: 2px solid #deb887;
      border-radius: 6px;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .rpg-btn:hover { opacity: 0.95; }
    .rpg-btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .rpg-hp-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .rpg-hp-label { min-width: 64px; font-size: 14px; }
    .rpg-hp-bar {
      flex: 1;
      height: 16px;
      background: #333;
      border: 2px solid #666;
      border-radius: 4px;
      overflow: hidden;
    }
    .rpg-hp-fill {
      height: 100%;
      background: linear-gradient(90deg, #c00 0%, #f44 100%);
      transition: width 0.3s;
    }
    .rpg-hp-fill.hero { background: linear-gradient(90deg, #0a0 0%, #4f4 100%); }
    .rpg-hp-num { font-size: 12px; min-width: 48px; text-align: right; }
    .rpg-log {
      min-height: 80px;
      margin: 12px 0;
      padding: 10px;
      background: rgba(0,0,0,0.5);
      border-radius: 4px;
      font-size: 14px;
      line-height: 1.5;
    }
    .rpg-actions { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-top: 12px; }
    .rpg-actions .rpg-btn { max-width: none; margin: 0; flex: 1 1 120px; }
    .rpg-back { display: inline-block; margin-top: 16px; color: #b8d4a8; font-size: 14px; text-decoration: none; }
    .rpg-back:hover { text-decoration: underline; }
  </style>
</head>
<body class="game-page">
  <div id="site-header"></div>

  <div class="rpg-container">
    <h1 class="rpg-title">小さな冒険</h1>

    <!-- スタート -->
    <div class="rpg-screen visible" id="screen-start">
      <div class="rpg-box">
        <p class="rpg-msg">洞窟の入口に立っている。奥からスライムの気配がする……。</p>
        <button type="button" class="rpg-btn" id="btn-start">冒険を始める</button>
      </div>
    </div>

    <!-- 戦闘 -->
    <div class="rpg-screen" id="screen-battle">
      <div class="rpg-box">
        <p class="rpg-msg" id="battle-enemy-name">スライムがあらわれた！</p>
        <div class="rpg-hp-row">
          <span class="rpg-hp-label">敵</span>
          <div class="rpg-hp-bar"><div class="rpg-hp-fill" id="enemy-hp-fill" style="width:100%"></div></div>
          <span class="rpg-hp-num" id="enemy-hp-num">10/10</span>
        </div>
        <div class="rpg-hp-row">
          <span class="rpg-hp-label">ゆうしゃ</span>
          <div class="rpg-hp-bar"><div class="rpg-hp-fill hero" id="hero-hp-fill" style="width:100%"></div></div>
          <span class="rpg-hp-num" id="hero-hp-num">20/20</span>
        </div>
        <div class="rpg-log" id="battle-log"></div>
        <div class="rpg-actions" id="battle-actions">
          <button type="button" class="rpg-btn" data-cmd="attack">攻撃</button>
          <button type="button" class="rpg-btn" data-cmd="magic">メラ（魔法）</button>
        </div>
      </div>
    </div>

    <!-- クリア -->
    <div class="rpg-screen" id="screen-clear">
      <div class="rpg-box">
        <p class="rpg-msg" id="clear-msg">洞窟を抜けた！ おめでとう！</p>
        <a href="/index.html" class="rpg-btn rpg-back">トップへ戻る</a>
      </div>
    </div>

    <!-- ゲームオーバー -->
    <div class="rpg-screen" id="screen-gameover">
      <div class="rpg-box">
        <p class="rpg-msg">ゆうしゃは たおれた……。</p>
        <button type="button" class="rpg-btn" id="btn-retry">やり直す</button>
        <a href="/index.html" class="rpg-back">トップへ戻る</a>
      </div>
    </div>
  </div>

  <script src="/assets/header.js"></script>
  <script>
(function () {
  var hero = { hp: 20, maxHp: 20, mp: 5, maxMp: 5, atk: 4, matk: 8 };
  var enemies = [
    { name: 'スライム', hp: 10, maxHp: 10, atk: 2 },
    { name: 'ホイミスライム', hp: 15, maxHp: 15, atk: 3 }
  ];
  var enemyIndex = 0;
  var currentEnemy = null;
  var isPlayerTurn = true;

  var screens = { start: 'screen-start', battle: 'screen-battle', clear: 'screen-clear', gameover: 'screen-gameover' };
  var logEl = document.getElementById('battle-log');
  var heroHpFill = document.getElementById('hero-hp-fill');
  var heroHpNum = document.getElementById('hero-hp-num');
  var enemyHpFill = document.getElementById('enemy-hp-fill');
  var enemyHpNum = document.getElementById('enemy-hp-num');
  var enemyNameEl = document.getElementById('battle-enemy-name');
  var battleActions = document.getElementById('battle-actions');

  function showScreen(id) {
    document.querySelectorAll('.rpg-screen').forEach(function (s) { s.classList.remove('visible'); });
    var el = document.getElementById(id);
    if (el) el.classList.add('visible');
  }

  function log(msg) {
    if (!logEl) return;
    logEl.textContent = (logEl.textContent ? logEl.textContent + '\n' : '') + msg;
    logEl.scrollTop = logEl.scrollHeight;
  }

  function setHeroHp() {
    var p = Math.max(0, (hero.hp / hero.maxHp) * 100);
    heroHpFill.style.width = p + '%';
    heroHpNum.textContent = hero.hp + '/' + hero.maxHp;
  }

  function setEnemyHp() {
    if (!currentEnemy) return;
    var p = Math.max(0, (currentEnemy.hp / currentEnemy.maxHp) * 100);
    enemyHpFill.style.width = p + '%';
    enemyHpNum.textContent = currentEnemy.hp + '/' + currentEnemy.maxHp;
  }

  function startBattle() {
    enemyIndex = 0;
    hero.hp = hero.maxHp;
    hero.mp = hero.maxMp;
    setHeroHp();
    currentEnemy = { name: enemies[0].name, hp: enemies[0].maxHp, maxHp: enemies[0].maxHp, atk: enemies[0].atk };
    enemyNameEl.textContent = currentEnemy.name + 'があらわれた！';
    logEl.textContent = '';
    log(currentEnemy.name + 'が あらわれた！');
    setEnemyHp();
    isPlayerTurn = true;
    battleActions.querySelectorAll('.rpg-btn').forEach(function (b) { b.disabled = false; });
    showScreen('screen-battle');
  }

  function doAttack() {
    if (!isPlayerTurn || !currentEnemy) return;
    var dmg = hero.atk + Math.floor(Math.random() * 3);
    dmg = Math.max(1, dmg);
    currentEnemy.hp -= dmg;
    currentEnemy.hp = Math.max(0, currentEnemy.hp);
    log('ゆうしゃの 攻撃！ ' + currentEnemy.name + 'に' + dmg + 'のダメージ！');
    setEnemyHp();
    if (currentEnemy.hp <= 0) {
      log(currentEnemy.name + 'を たおした！');
      isPlayerTurn = false;
      setTimeout(nextEnemyOrClear, 800);
      return;
    }
    isPlayerTurn = false;
    battleActions.querySelectorAll('.rpg-btn').forEach(function (b) { b.disabled = true; });
    setTimeout(enemyTurn, 1000);
  }

  function doMagic() {
    if (!isPlayerTurn || !currentEnemy || hero.mp < 2) return;
    hero.mp -= 2;
    var dmg = hero.matk + Math.floor(Math.random() * 4);
    dmg = Math.max(2, dmg);
    currentEnemy.hp -= dmg;
    currentEnemy.hp = Math.max(0, currentEnemy.hp);
    log('メラ！ ' + currentEnemy.name + 'に' + dmg + 'のダメージ！');
    setEnemyHp();
    setHeroHp();
    if (currentEnemy.hp <= 0) {
      log(currentEnemy.name + 'を たおした！');
      isPlayerTurn = false;
      setTimeout(nextEnemyOrClear, 800);
      return;
    }
    isPlayerTurn = false;
    battleActions.querySelectorAll('.rpg-btn').forEach(function (b) { b.disabled = true; });
    setTimeout(enemyTurn, 1000);
  }

  function enemyTurn() {
    if (!currentEnemy || currentEnemy.hp <= 0) return;
    var dmg = currentEnemy.atk + Math.floor(Math.random() * 2);
    dmg = Math.max(1, dmg);
    hero.hp -= dmg;
    hero.hp = Math.max(0, hero.hp);
    log(currentEnemy.name + 'の 攻撃！ ゆうしゃに' + dmg + 'のダメージ！');
    setHeroHp();
    if (hero.hp <= 0) {
      showScreen('screen-gameover');
      return;
    }
    isPlayerTurn = true;
    battleActions.querySelectorAll('.rpg-btn').forEach(function (b) {
      b.disabled = (b.dataset.cmd === 'magic' && hero.mp < 2);
    });
  }

  function nextEnemyOrClear() {
    enemyIndex++;
    if (enemyIndex >= enemies.length) {
      document.getElementById('clear-msg').textContent = '洞窟を抜けた！ おめでとう！';
      showScreen('screen-clear');
      return;
    }
    currentEnemy = {
      name: enemies[enemyIndex].name,
      hp: enemies[enemyIndex].maxHp,
      maxHp: enemies[enemyIndex].maxHp,
      atk: enemies[enemyIndex].atk
    };
    enemyNameEl.textContent = currentEnemy.name + 'があらわれた！';
    log(currentEnemy.name + 'が あらわれた！');
    setEnemyHp();
    isPlayerTurn = true;
    battleActions.querySelectorAll('.rpg-btn').forEach(function (b) {
      b.disabled = (b.dataset.cmd === 'magic' && hero.mp < 2);
    });
  }

  document.getElementById('btn-start').addEventListener('click', startBattle);
  document.getElementById('btn-retry').addEventListener('click', startBattle);
  battleActions.addEventListener('click', function (e) {
    var cmd = e.target.dataset.cmd;
    if (cmd === 'attack') doAttack();
    if (cmd === 'magic') doMagic();
  });
})();
  </script>
</body>
</html>
