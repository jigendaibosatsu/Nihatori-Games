<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>モンスターコレクション – Nihatori Games</title>
  <link rel="stylesheet" href="/styles.css" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { min-height: 100%; }
    body.game-page {
      padding-top: 48px;
      background: linear-gradient(180deg, #1b5e20 0%, #2e7d32 40%, #388e3c 100%);
      font-family: "MS PGothic", "Yu Gothic", sans-serif;
      color: #e8f5e9;
      min-height: 100vh;
      min-height: 100dvh;
      display: flex;
      flex-direction: column;
    }
    .mc-wrap {
      max-width: 420px;
      margin: 0 auto;
      padding: 12px;
      width: 100%;
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
    }
    .mc-title { font-size: 1.2rem; margin-bottom: 8px; text-align: center; font-weight: bold; color: #fff; text-shadow: 0 0 10px rgba(129,199,132,0.6); }
    .mc-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    .mc-tab {
      flex: 1;
      padding: 10px;
      font-size: 14px;
      font-weight: bold;
      color: #fff;
      background: rgba(255,255,255,0.2);
      border: 2px solid #81c784;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      -webkit-tap-highlight-color: transparent;
    }
    .mc-tab.active { background: #2e7d32; border-color: #a5d6a7; }
    .mc-tab:hover { opacity: 0.9; }
    .mc-explore-area {
      padding: 16px;
      background: rgba(0,0,0,0.25);
      border-radius: 12px;
      margin-bottom: 12px;
      text-align: center;
      border: 2px solid #66bb6a;
    }
    .mc-encounter { display: none; margin-bottom: 12px; }
    .mc-encounter.visible { display: block; }
    .mc-monster-card {
      padding: 20px;
      background: rgba(255,255,255,0.15);
      border-radius: 12px;
      border: 3px solid #81c784;
      margin-bottom: 12px;
    }
    .mc-monster-name { font-size: 1.3rem; font-weight: bold; margin-bottom: 4px; color: #fff; }
    .mc-monster-type { font-size: 12px; color: #a5d6a7; margin-bottom: 8px; }
    .mc-monster-rarity {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: bold;
    }
    .mc-monster-rarity.common { background: #9e9e9e; color: #fff; }
    .mc-monster-rarity.rare { background: #5c6bc0; color: #fff; }
    .mc-monster-rarity.super { background: #ff8f00; color: #fff; }
    .mc-catch-btn {
      display: block;
      width: 100%;
      padding: 14px;
      font-size: 16px;
      font-weight: bold;
      color: #fff;
      background: linear-gradient(180deg, #43a047, #2e7d32);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 12px;
      -webkit-tap-highlight-color: transparent;
    }
    .mc-catch-btn:hover { opacity: 0.95; }
    .mc-catch-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .mc-explore-btn {
      display: block;
      width: 100%;
      padding: 14px;
      font-size: 18px;
      font-weight: bold;
      color: #1b5e20;
      background: linear-gradient(180deg, #a5d6a7, #81c784);
      border: 2px solid #66bb6a;
      border-radius: 10px;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .mc-explore-btn:hover { opacity: 0.95; }
    .mc-result { margin-top: 12px; padding: 10px; border-radius: 8px; font-size: 14px; font-weight: bold; text-align: center; display: none; }
    .mc-result.visible { display: block; }
    .mc-result.success { background: #2e7d32; color: #fff; }
    .mc-result.fail { background: #c62828; color: #fff; }
    .mc-dex {
      flex: 1 1 0;
      min-height: 0;
      overflow-y: auto;
      padding: 8px 0;
      -webkit-overflow-scrolling: touch;
    }
    .mc-dex-count { font-size: 14px; margin-bottom: 10px; text-align: center; color: #c8e6c9; }
    .mc-dex-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .mc-dex-cell {
      padding: 12px 8px;
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      border: 2px solid #66bb6a;
      text-align: center;
      font-size: 12px;
    }
    .mc-dex-cell.caught { background: rgba(46,125,50,0.5); border-color: #a5d6a7; }
    .mc-dex-cell .name { font-weight: bold; margin-bottom: 2px; color: #fff; }
    .mc-dex-cell .name.unknown { color: #888; }
    .mc-dex-cell .type { font-size: 10px; color: #a5d6a7; }
    .mc-dex-cell .count { font-size: 11px; color: #c8e6c9; margin-top: 4px; }
    .mc-back { display: inline-block; margin-top: 12px; color: #81c784; font-size: 14px; text-decoration: none; }
    .mc-back:hover { text-decoration: underline; }
  </style>
</head>
<body class="game-page">
  <div id="site-header"></div>

  <div class="mc-wrap">
    <h1 class="mc-title">モンスターコレクション</h1>

    <div class="mc-tabs">
      <button type="button" class="mc-tab active" data-tab="explore">探索</button>
      <button type="button" class="mc-tab" data-tab="dex">図鑑</button>
    </div>

    <div id="mcExplorePanel">
      <div class="mc-explore-area">
        <p style="margin-bottom:12px;font-size:14px;">森を探索してモンスターを探そう！<br>見つけたらつかまえてコレクションに加えよう。</p>
        <button type="button" class="mc-explore-btn" id="mcExploreBtn">探索する</button>
      </div>

      <div class="mc-encounter" id="mcEncounter">
        <div class="mc-monster-card" id="mcMonsterCard">
          <div class="mc-monster-name" id="mcMonsterName">???</div>
          <div class="mc-monster-type" id="mcMonsterType">???</div>
          <span class="mc-monster-rarity common" id="mcMonsterRarity">???</span>
        </div>
        <button type="button" class="mc-catch-btn" id="mcCatchBtn">つかまえる！</button>
        <div class="mc-result" id="mcResult"></div>
      </div>
    </div>

    <div id="mcDexPanel" style="display:none">
      <div class="mc-dex-count" id="mcDexCount">0 / 0 種類 捕まえた</div>
      <div class="mc-dex" id="mcDex"></div>
    </div>

    <a href="/index.html" class="mc-back">← トップへ戻る</a>
  </div>

  <script src="/assets/header.js"></script>
  <script>
(function () {
  var MONSTERS = [
    { id: 'm1', name: 'スライム', type: 'スライム', rarity: 'common' },
    { id: 'm2', name: 'バット', type: '飛行', rarity: 'common' },
    { id: 'm3', name: 'ゴブリン', type: '人型', rarity: 'common' },
    { id: 'm4', name: 'ウルフ', type: '獣', rarity: 'common' },
    { id: 'm5', name: 'スケルトン', type: 'アンデッド', rarity: 'common' },
    { id: 'm6', name: 'キノコン', type: '植物', rarity: 'common' },
    { id: 'm7', name: 'ハニービー', type: '虫', rarity: 'common' },
    { id: 'm8', name: 'メタルスライム', type: 'スライム', rarity: 'rare' },
    { id: 'm9', name: 'ウィスプ', type: '精霊', rarity: 'rare' },
    { id: 'm10', name: 'サハギン', type: '水棲', rarity: 'rare' },
    { id: 'm11', name: 'マンドラ', type: '植物', rarity: 'rare' },
    { id: 'm12', name: 'フェニックス', type: '炎', rarity: 'rare' },
    { id: 'm13', name: 'ドラゴン', type: '竜', rarity: 'super' },
    { id: 'm14', name: 'キングスライム', type: 'スライム', rarity: 'super' },
    { id: 'm15', name: 'デーモン', type: '悪魔', rarity: 'super' },
    { id: 'm16', name: 'ユニコーン', type: '幻獣', rarity: 'super' },
    { id: 'm17', name: 'ゴースト', type: 'アンデッド', rarity: 'common' },
    { id: 'm18', name: 'トード', type: '両生', rarity: 'common' },
    { id: 'm19', name: 'ウィザード', type: '人型', rarity: 'rare' },
    { id: 'm20', name: 'レジェンド', type: '伝説', rarity: 'super' }
  ];

  var CATCH_RATE = { common: 0.75, rare: 0.5, super: 0.3 };

  var state = {
    caught: {},
    currentMonster: null,
    encounterVisible: false
  };

  function initCaught() {
    MONSTERS.forEach(function (m) {
      if (state.caught[m.id] === undefined) state.caught[m.id] = 0;
    });
  }

  function getEncounter() {
    var r = Math.random();
    var pool = r < 0.6 ? MONSTERS.filter(function (m) { return m.rarity === 'common'; })
      : r < 0.9 ? MONSTERS.filter(function (m) { return m.rarity === 'rare'; })
      : MONSTERS.filter(function (m) { return m.rarity === 'super'; });
    return pool[Math.floor(Math.random() * pool.length)];
  }

  function showEncounter(monster) {
    state.currentMonster = monster;
    state.encounterVisible = true;
    document.getElementById('mcMonsterName').textContent = monster.name;
    document.getElementById('mcMonsterType').textContent = monster.type;
    var rarityEl = document.getElementById('mcMonsterRarity');
    rarityEl.textContent = monster.rarity === 'common' ? 'ノーマル' : monster.rarity === 'rare' ? 'レア' : 'スーパーレア';
    rarityEl.className = 'mc-monster-rarity ' + monster.rarity;
    document.getElementById('mcEncounter').classList.add('visible');
    document.getElementById('mcResult').classList.remove('visible');
    document.getElementById('mcCatchBtn').disabled = false;
  }

  function hideEncounter() {
    state.encounterVisible = false;
    state.currentMonster = null;
    document.getElementById('mcEncounter').classList.remove('visible');
  }

  function tryCatch() {
    if (!state.currentMonster) return;
    document.getElementById('mcCatchBtn').disabled = true;
    var rate = CATCH_RATE[state.currentMonster.rarity];
    var success = Math.random() < rate;
    var resultEl = document.getElementById('mcResult');
    resultEl.className = 'mc-result visible ' + (success ? 'success' : 'fail');
    if (success) {
      state.caught[state.currentMonster.id] = (state.caught[state.currentMonster.id] || 0) + 1;
      resultEl.textContent = state.currentMonster.name + ' を つかまえた！';
      renderDex();
      setTimeout(hideEncounter, 1200);
    } else {
      resultEl.textContent = 'にげられた…';
    }
  }

  function renderDex() {
    var total = MONSTERS.length;
    var caughtTypes = 0;
    MONSTERS.forEach(function (m) {
      if ((state.caught[m.id] || 0) > 0) caughtTypes++;
    });
    document.getElementById('mcDexCount').textContent = caughtTypes + ' / ' + total + ' 種類 捕まえた';
    var grid = document.getElementById('mcDex');
    grid.innerHTML = '';
    MONSTERS.forEach(function (m) {
      var count = state.caught[m.id] || 0;
      var cell = document.createElement('div');
      cell.className = 'mc-dex-cell' + (count > 0 ? ' caught' : '');
      cell.innerHTML =
        '<div class="name' + (count > 0 ? '' : ' unknown') + '">' + (count > 0 ? m.name : '???') + '</div>' +
        '<div class="type">' + (count > 0 ? m.type : '???') + '</div>' +
        (count > 0 ? '<div class="count">×' + count + '</div>' : '');
      grid.appendChild(cell);
    });
  }

  document.getElementById('mcExploreBtn').addEventListener('click', function () {
    showEncounter(getEncounter());
  });

  document.getElementById('mcCatchBtn').addEventListener('click', tryCatch);

  document.querySelectorAll('.mc-tab').forEach(function (tab) {
    tab.addEventListener('click', function () {
      var t = this.getAttribute('data-tab');
      document.querySelectorAll('.mc-tab').forEach(function (x) { x.classList.remove('active'); });
      this.classList.add('active');
      document.getElementById('mcExplorePanel').style.display = t === 'explore' ? 'block' : 'none';
      document.getElementById('mcDexPanel').style.display = t === 'dex' ? 'block' : 'none';
      if (t === 'dex') renderDex();
    });
  });

  initCaught();
  renderDex();
})();
  </script>
</body>
</html>
