{"version":3,"file":"index-C9eEqdC_.js","sources":["../../src/config.ts","../../src/character.ts","../../src/enemy.ts","../../src/gesture.ts","../../src/input.ts","../../src/render.ts","../../src/ui.ts","../../src/game.ts","../../src/main.ts"],"sourcesContent":["/**\n * PuniPuni Arena - Centralized configuration\n * All thresholds, cooldowns, and damage multipliers are tunable here.\n */\n\nexport const CONFIG = {\n  // Fixed timestep (60 Hz)\n  FIXED_DT_MS: 1000 / 60,\n  TARGET_FPS: 60,\n\n  // Arena\n  ARENA_WIDTH: 800,\n  ARENA_HEIGHT: 600,\n  ARENA_PADDING: 40,\n\n  // Character (PuniPuni)\n  CHARACTER_RADIUS: 28,\n  CHARACTER_HP: 100,\n  CHARACTER_ATK: 12,\n  CHARACTER_DEF: 5,\n  CHARACTER_SPEED: 4,\n  CHARACTER_CONDITION: 1.0,\n  CONDITION_MIN: 0.5,\n  CONDITION_MAX: 1.5,\n  ENERGY_MAX: 100,\n  ENERGY_GAIN_PER_HIT: 5,\n  ENERGY_DECAY_RATE: 0.2,\n\n  // Damage formula: max(1, (ATK * skillMult * condition) - (DEF * 0.7)) * rand(0.9..1.1)\n  DAMAGE_DEF_MULT: 0.7,\n  DAMAGE_RAND_MIN: 0.9,\n  DAMAGE_RAND_MAX: 1.1,\n\n  // State priority (higher = more priority): HITSTUN > DOWN > STONE > GIANT > SPIN > HYPER > ATTACK > MOVE > IDLE\n  STATES: {\n    IDLE: 0,\n    MOVE: 1,\n    ATTACK: 2,\n    HYPER: 3,\n    SPIN: 4,\n    GIANT_CHARGE: 5,\n    GIANT_SLAM: 6,\n    STONE: 7,\n    DOWN: 8,\n    HITSTUN: 9,\n  } as const,\n\n  // Normal Attack\n  ATTACK_STARTUP_MS: 80,\n  ATTACK_ACTIVE_MS: 100,\n  ATTACK_RECOVERY_MS: 120,\n  ATTACK_MULTIPLIER: 1.0,\n  ATTACK_RANGE: 70,\n\n  // Stone Form (double-click on character)\n  STONE_I_FRAMES_MS: 200,\n  STONE_DURATION_MS: 2500,\n  STONE_DEF_BOOST: 2.0,\n  STONE_SPEED_MULT: 0.3,\n  STONE_COOLDOWN_MS: 8000,\n\n  // Hyper Attack (double-click on empty)\n  HYPER_ENERGY_COST: 50,\n  HYPER_COOLDOWN_MS: 5000,\n  HYPER_DASH_SPEED: 18,\n  HYPER_DURATION_MS: 400,\n  HYPER_MULTIPLIER: 2.5,\n  HYPER_AOE_RADIUS: 80,\n\n  // Multiply (rapid clicks on character)\n  MULTIPLY_CLICKS_NEEDED: 6,\n  MULTIPLY_TIME_WINDOW_MS: 800,\n  MULTIPLY_CLONE_COUNT_MIN: 2,\n  MULTIPLY_CLONE_COUNT_MAX: 5,\n  MULTIPLY_COOLDOWN_MS: 10000,\n  MULTIPLY_CLONE_LIFETIME_MS: 6000,\n  MULTIPLY_CLONE_DAMAGE_MULT: 0.3,\n  MULTIPLY_CLONE_RADIUS: 16,\n\n  // Spin Attack (circular gesture)\n  SPIN_ANGLE_THRESHOLD_DEG: 300,\n  SPIN_TIME_WINDOW_MS: 700,\n  SPIN_DISTANCE_FROM_CHAR: 50,\n  SPIN_DURATION_MS: 1200,\n  SPIN_TICK_MS: 100,\n  SPIN_MULTIPLIER: 0.6,\n  SPIN_AOE_RADIUS: 100,\n  SPIN_COOLDOWN_MS: 6000,\n\n  // Giant Smash (vertical hold + drag)\n  GIANT_HOLD_THRESHOLD_MS: 150,\n  GIANT_VERTICAL_THRESHOLD: 40,\n  GIANT_CHARGE_MS: 600,\n  GIANT_SLAM_MS: 400,\n  GIANT_AOE_RADIUS: 120,\n  GIANT_MULTIPLIER: 3.0,\n  GIANT_COOLDOWN_MS: 12000,\n\n  // Double-click detection\n  DOUBLE_CLICK_THRESHOLD_MS: 250,\n\n  // Gesture thresholds\n  POINTER_CAPTURE_ENABLED: true,\n  SPIN_MIN_DISTANCE: 20,\n  GIANT_MIN_VERTICAL: 40,\n\n  // Enemy\n  ENEMY_SPAWN_INTERVAL_MS: 3000,\n  ENEMY_HP: 30,\n  ENEMY_ATK: 8,\n  ENEMY_DEF: 2,\n  ENEMY_RADIUS: 20,\n  ENEMY_SPEED: 2,\n  ENEMY_KNOCKBACK: 80,\n  ENEMY_DAMAGE_COOLDOWN_MS: 800,\n  ENEMIES_TO_DEFEAT: 15,\n  SURVIVAL_TIME_MS: 60000,\n\n  // Knockback\n  PLAYER_KNOCKBACK: 60,\n  HITSTUN_MS: 400,\n  DOWN_MS: 800,\n\n  // VFX\n  SCREEN_SHAKE_AMOUNT: 4,\n  HIT_FLASH_MS: 80,\n} as const;\n\nexport type StateKey = keyof typeof CONFIG.STATES;\n","/**\n * PuniPuni character - blob with HP, ATK, DEF, Condition, Energy\n */\n\nimport { CONFIG } from './config';\n\nexport type StateId = (typeof CONFIG.STATES)[keyof typeof CONFIG.STATES];\n\nexport interface PuniPuni {\n  x: number;\n  y: number;\n  vx: number;\n  vy: number;\n  radius: number;\n  hp: number;\n  maxHp: number;\n  atk: number;\n  def: number;\n  condition: number;\n  energy: number;\n  state: StateId;\n  stateTimer: number;\n  invulnerable: number;\n  // Cooldowns (in ms remaining)\n  cooldownStone: number;\n  cooldownHyper: number;\n  cooldownMultiply: number;\n  cooldownSpin: number;\n  cooldownGiant: number;\n  // Attack phase\n  attackPhase: 'idle' | 'startup' | 'active' | 'recovery';\n  attackHitDealt: boolean;\n  attackTargetX: number;\n  attackTargetY: number;\n  // Stone\n  stoneDefBoost: number;\n  stoneSpeedMult: number;\n  // Hyper\n  hyperDirX: number;\n  hyperDirY: number;\n  hyperDamageDealt: boolean;\n  // Spin\n  spinAngle: number;\n  spinLastDamageTime: number;\n  // Giant\n  giantScale: number;\n  giantSlamY: number;\n  giantDamageDealt: boolean;\n  // Clones\n  clones: Clone[];\n}\n\nexport interface Clone {\n  x: number;\n  y: number;\n  radius: number;\n  lifetime: number;\n  maxLifetime: number;\n  lastAttackTime: number;\n}\n\nexport function createPuniPuni(): PuniPuni {\n  return {\n    x: CONFIG.ARENA_WIDTH / 2,\n    y: CONFIG.ARENA_HEIGHT / 2,\n    vx: 0,\n    vy: 0,\n    radius: CONFIG.CHARACTER_RADIUS,\n    hp: CONFIG.CHARACTER_HP,\n    maxHp: CONFIG.CHARACTER_HP,\n    atk: CONFIG.CHARACTER_ATK,\n    def: CONFIG.CHARACTER_DEF,\n    condition: CONFIG.CHARACTER_CONDITION,\n    energy: 0,\n    state: CONFIG.STATES.IDLE,\n    stateTimer: 0,\n    invulnerable: 0,\n    cooldownStone: 0,\n    cooldownHyper: 0,\n    cooldownMultiply: 0,\n    cooldownSpin: 0,\n    cooldownGiant: 0,\n  attackPhase: 'idle',\n  attackHitDealt: false,\n  attackTargetX: 0,\n  attackTargetY: 0,\n    stoneDefBoost: 1,\n    stoneSpeedMult: 1,\n  hyperDirX: 0,\n  hyperDirY: 0,\n  hyperDamageDealt: false,\n    spinAngle: 0,\n  spinLastDamageTime: 0,\n  giantScale: 1,\n  giantSlamY: 0,\n  giantDamageDealt: false,\n    clones: [],\n  };\n}\n\n/** Compute damage: max(1, (ATK * mult * cond) - (DEF * 0.7)) * rand(0.9..1.1) */\nexport function computeDamage(\n  atk: number,\n  def: number,\n  condition: number,\n  skillMultiplier: number\n): number {\n  const raw = atk * skillMultiplier * condition - def * CONFIG.DAMAGE_DEF_MULT;\n  const base = Math.max(1, raw);\n  const rand =\n    CONFIG.DAMAGE_RAND_MIN +\n    Math.random() * (CONFIG.DAMAGE_RAND_MAX - CONFIG.DAMAGE_RAND_MIN);\n  return Math.max(1, Math.floor(base * rand));\n}\n\nexport function distance(x1: number, y1: number, x2: number, y2: number): number {\n  return Math.hypot(x2 - x1, y2 - y1);\n}\n\nexport function isPointInCircle(\n  px: number,\n  py: number,\n  cx: number,\n  cy: number,\n  r: number\n): boolean {\n  return distance(px, py, cx, cy) <= r;\n}\n","/**\n * Simple chase-and-attack enemies with contact damage\n */\n\nimport { CONFIG } from './config';\nimport { distance } from './character';\n\nexport interface Enemy {\n  id: number;\n  x: number;\n  y: number;\n  vx: number;\n  vy: number;\n  radius: number;\n  hp: number;\n  maxHp: number;\n  atk: number;\n  def: number;\n  speed: number;\n  damageCooldown: number;\n}\n\nlet nextId = 1;\n\nexport function createEnemy(x: number, y: number): Enemy {\n  return {\n    id: nextId++,\n    x,\n    y,\n    vx: 0,\n    vy: 0,\n    radius: CONFIG.ENEMY_RADIUS,\n    hp: CONFIG.ENEMY_HP,\n    maxHp: CONFIG.ENEMY_HP,\n    atk: CONFIG.ENEMY_ATK,\n    def: CONFIG.ENEMY_DEF,\n    speed: CONFIG.ENEMY_SPEED,\n    damageCooldown: 0,\n  };\n}\n\nexport function updateEnemy(\n  enemy: Enemy,\n  playerX: number,\n  playerY: number,\n  dt: number\n): void {\n  const dist = distance(enemy.x, enemy.y, playerX, playerY);\n  if (dist > 0) {\n    const dx = (playerX - enemy.x) / dist;\n    const dy = (playerY - enemy.y) / dist;\n    enemy.vx = dx * enemy.speed;\n    enemy.vy = dy * enemy.speed;\n    enemy.x += enemy.vx * (dt / 1000) * 60;\n    enemy.y += enemy.vy * (dt / 1000) * 60;\n  }\n  if (enemy.damageCooldown > 0) enemy.damageCooldown -= dt;\n}\n\nexport function clampToArena(e: Enemy): void {\n  const r = CONFIG.ARENA_PADDING + e.radius;\n  e.x = Math.max(r, Math.min(CONFIG.ARENA_WIDTH - r, e.x));\n  e.y = Math.max(r, Math.min(CONFIG.ARENA_HEIGHT - r, e.y));\n}\n\nexport function circlesOverlap(\n  x1: number,\n  y1: number,\n  r1: number,\n  x2: number,\n  y2: number,\n  r2: number\n): boolean {\n  return distance(x1, y1, x2, y2) < r1 + r2;\n}\n","/**\n * Gesture recognition for PuniPuni Arena\n * - Double-click: Stone (on char) / Hyper (on empty)\n * - Rapid clicks: Multiply\n * - Spin: circular motion around character\n * - Giant: hold on char + vertical drag\n */\n\nimport { CONFIG } from './config';\nimport { distance } from './character';\n\nexport interface GestureState {\n  clickHistory: Array<{ time: number; x: number; y: number; onChar: boolean }>;\n  pointerDownTime: number;\n  pointerDownX: number;\n  pointerDownY: number;\n  pointerDownOnChar: boolean;\n  lastAngle: number;\n  cumulativeAngle: number;\n  lastMoveTime: number;\n  verticalStartY: number;\n  verticalMoved: boolean;\n  lastClickTime: number;\n  lastClickX: number;\n  lastClickY: number;\n  lastClickOnChar: boolean;\n}\n\nexport function createGestureState(): GestureState {\n  return {\n    clickHistory: [],\n    pointerDownTime: 0,\n    pointerDownX: 0,\n    pointerDownY: 0,\n    pointerDownOnChar: false,\n    lastAngle: 0,\n    cumulativeAngle: 0,\n    lastMoveTime: 0,\n  verticalStartY: 0,\n  verticalMoved: false,\n  lastClickTime: 0,\n  lastClickX: 0,\n  lastClickY: 0,\n  lastClickOnChar: false,\n};\n}\n\nexport type GestureResult =\n  | { type: 'none' }\n  | { type: 'move'; x: number; y: number }\n  | { type: 'attack' }\n  | { type: 'double_stone' }\n  | { type: 'double_hyper'; x: number; y: number }\n  | { type: 'multiply' }\n  | { type: 'spin' }\n  | { type: 'giant_charge' }\n  | { type: 'giant_release' };\n\n/** Record a click and check for Multiply (rapid clicks on character) */\nexport function recordClick(\n  g: GestureState,\n  x: number,\n  y: number,\n  onChar: boolean,\n  now: number\n): GestureResult {\n  g.clickHistory.push({ time: now, x, y, onChar });\n  // Prune old clicks outside window\n  const cutoff = now - CONFIG.MULTIPLY_TIME_WINDOW_MS;\n  g.clickHistory = g.clickHistory.filter((c) => c.time > cutoff);\n  const onCharClicks = g.clickHistory.filter((c) => c.onChar);\n  if (\n    onCharClicks.length >= CONFIG.MULTIPLY_CLICKS_NEEDED &&\n    onCharClicks[onCharClicks.length - 1].time - onCharClicks[0].time <=\n      CONFIG.MULTIPLY_TIME_WINDOW_MS\n  ) {\n    g.clickHistory = [];\n    return { type: 'multiply' };\n  }\n  return { type: 'none' };\n}\n\n/** Check for double-click (Stone on char, Hyper on empty). Call on pointer DOWN. */\nexport function checkDoubleClick(\n  g: GestureState,\n  x: number,\n  y: number,\n  onChar: boolean,\n  now: number\n): GestureResult {\n  const dt = now - g.lastClickTime;\n  const sameSpot = distance(x, y, g.lastClickX, g.lastClickY) < 50;\n  if (dt <= CONFIG.DOUBLE_CLICK_THRESHOLD_MS && sameSpot && dt > 0) {\n    if (onChar) return { type: 'double_stone' };\n    return { type: 'double_hyper', x, y };\n  }\n  return { type: 'none' };\n}\n\n/** Store last click for double-check (call on pointer up when it was a quick tap) */\nexport function setLastClick(\n  g: GestureState,\n  x: number,\n  y: number,\n  onChar: boolean,\n  now: number\n): void {\n  g.lastClickTime = now;\n  g.lastClickX = x;\n  g.lastClickY = y;\n  g.lastClickOnChar = onChar;\n}\n\n/** Start tracking pointer down (for spin/giant) */\nexport function pointerDown(\n  g: GestureState,\n  x: number,\n  y: number,\n  charX: number,\n  charY: number,\n  charR: number,\n  now: number\n): void {\n  g.pointerDownTime = now;\n  g.pointerDownX = x;\n  g.pointerDownY = y;\n  g.pointerDownOnChar = distance(x, y, charX, charY) <= charR + 10;\n  g.lastAngle = Math.atan2(y - charY, x - charX);\n  g.cumulativeAngle = 0;\n  g.lastMoveTime = now;\n  g.verticalStartY = y;\n  g.verticalMoved = false;\n}\n\n/** Update during pointer move - returns Spin or Giant gestures if detected */\nexport function pointerMove(\n  g: GestureState,\n  x: number,\n  y: number,\n  charX: number,\n  charY: number,\n  charR: number,\n  now: number\n): { spin: boolean; giantCharge: boolean } {\n  if (!g.pointerDownOnChar) return { spin: false, giantCharge: false };\n\n  const dist = distance(x, y, charX, charY);\n  if (dist < CONFIG.SPIN_MIN_DISTANCE) return { spin: false, giantCharge: false };\n\n  const angle = Math.atan2(y - charY, x - charX);\n  let delta = angle - g.lastAngle;\n  if (delta > Math.PI) delta -= Math.PI * 2;\n  if (delta < -Math.PI) delta += Math.PI * 2;\n  g.cumulativeAngle += Math.abs(delta) * (180 / Math.PI);\n  g.lastAngle = angle;\n\n  const verticalDist = Math.abs(y - g.verticalStartY);\n  if (verticalDist >= CONFIG.GIANT_MIN_VERTICAL) g.verticalMoved = true;\n\n  const holdTime = now - g.pointerDownTime;\n  const spinOk =\n    g.cumulativeAngle >= CONFIG.SPIN_ANGLE_THRESHOLD_DEG &&\n    holdTime <= CONFIG.SPIN_TIME_WINDOW_MS;\n  const giantOk =\n    holdTime >= CONFIG.GIANT_HOLD_THRESHOLD_MS && g.verticalMoved;\n\n  return { spin: spinOk, giantCharge: giantOk };\n}\n\nexport function pointerUp(g: GestureState): void {\n  g.pointerDownTime = 0;\n}\n\nexport function getCumulativeAngle(g: GestureState): number {\n  return g.cumulativeAngle;\n}\n","/**\n * Input handling - Pointer Events (mouse + touch)\n * Provides pointer position, click/tap events, and capture for gestures.\n */\n\nexport interface PointerEventData {\n  x: number;\n  y: number;\n  pointerId: number;\n  type: 'down' | 'move' | 'up' | 'cancel';\n  target: EventTarget | null;\n  time: number;\n}\n\nexport interface InputState {\n  pointers: Map<number, { x: number; y: number; downTime: number }>;\n  lastClickTime: number;\n  lastClickX: number;\n  lastClickY: number;\n  lastClickOnCharacter: boolean;\n  moveTarget: { x: number; y: number } | null;\n  captureActive: boolean;\n}\n\nexport function createInputState(): InputState {\n  return {\n    pointers: new Map(),\n    lastClickTime: 0,\n    lastClickX: 0,\n    lastClickY: 0,\n    lastClickOnCharacter: false,\n    moveTarget: null,\n    captureActive: false,\n  };\n}\n\nexport function getPointerPosition(\n  e: PointerEvent,\n  canvas: HTMLCanvasElement\n): { x: number; y: number } {\n  const rect = canvas.getBoundingClientRect();\n  const scaleX = canvas.width / rect.width;\n  const scaleY = canvas.height / rect.height;\n  return {\n    x: (e.clientX - rect.left) * scaleX,\n    y: (e.clientY - rect.top) * scaleY,\n  };\n}\n\nexport function setupPointerCapture(\n  canvas: HTMLCanvasElement,\n  useCapture: boolean\n): void {\n  canvas.addEventListener(\n    'pointerdown',\n    (e) => {\n      if (useCapture && e.pointerType !== 'mouse') {\n        (e.target as HTMLElement).setPointerCapture(e.pointerId);\n      }\n    },\n    { passive: true }\n  );\n}\n","/**\n * Canvas rendering - PuniPuni blob, enemies, arena, VFX\n */\n\nimport { CONFIG } from './config';\nimport { GameState } from './game';\nimport { PuniPuni } from './character';\n\nconst STATE_NAMES: Record<number, string> = {\n  [CONFIG.STATES.IDLE]: 'IDLE',\n  [CONFIG.STATES.MOVE]: 'MOVE',\n  [CONFIG.STATES.ATTACK]: 'ATTACK',\n  [CONFIG.STATES.HYPER]: 'HYPER',\n  [CONFIG.STATES.SPIN]: 'SPIN',\n  [CONFIG.STATES.GIANT_CHARGE]: 'GIANT_CHARGE',\n  [CONFIG.STATES.GIANT_SLAM]: 'GIANT_SLAM',\n  [CONFIG.STATES.STONE]: 'STONE',\n  [CONFIG.STATES.DOWN]: 'DOWN',\n  [CONFIG.STATES.HITSTUN]: 'HITSTUN',\n};\n\nfunction drawBlob(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  radius: number,\n  color: string,\n  alpha = 1\n): void {\n  ctx.save();\n  ctx.globalAlpha = alpha;\n  ctx.fillStyle = color;\n  ctx.beginPath();\n  ctx.arc(x, y, radius, 0, Math.PI * 2);\n  ctx.fill();\n  ctx.strokeStyle = 'rgba(255,255,255,0.5)';\n  ctx.lineWidth = 2;\n  ctx.stroke();\n  ctx.restore();\n}\n\nexport function draw(gs: GameState): void {\n  const ctx = gs.ctx;\n  const canvas = gs.canvas;\n  const p = gs.player;\n  const shakeX = (Math.random() - 0.5) * gs.screenShake * 2;\n  const shakeY = (Math.random() - 0.5) * gs.screenShake * 2;\n\n  ctx.save();\n  ctx.translate(shakeX, shakeY);\n\n  // Hit flash overlay\n  if (gs.hitFlash > 0) {\n    ctx.fillStyle = `rgba(255,80,80,${gs.hitFlash / CONFIG.HIT_FLASH_MS})`;\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n  }\n\n  // Arena background\n  ctx.fillStyle = '#0f0f1e';\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n  // Arena border\n  ctx.strokeStyle = '#4a3a6a';\n  ctx.lineWidth = 4;\n  ctx.strokeRect(\n    CONFIG.ARENA_PADDING / 2,\n    CONFIG.ARENA_PADDING / 2,\n    CONFIG.ARENA_WIDTH - CONFIG.ARENA_PADDING,\n    CONFIG.ARENA_HEIGHT - CONFIG.ARENA_PADDING\n  );\n\n  // Enemies\n  gs.enemies.forEach((e) => {\n    drawBlob(ctx, e.x, e.y, e.radius, '#f59e0b');\n    const barW = e.radius * 2;\n    const barH = 4;\n    ctx.fillStyle = '#333';\n    ctx.fillRect(e.x - barW / 2, e.y - e.radius - 10, barW, barH);\n    ctx.fillStyle = '#22c55e';\n    ctx.fillRect(\n      e.x - barW / 2,\n      e.y - e.radius - 10,\n      barW * (e.hp / e.maxHp),\n      barH\n    );\n  });\n\n  // Clones\n  p.clones.forEach((c) => {\n    const t = c.lifetime / c.maxLifetime;\n    drawBlob(ctx, c.x, c.y, c.radius, '#a78bfa', 0.5 + t * 0.5);\n  });\n\n  // PuniPuni\n  let color = '#60a5fa';\n  if (p.state === CONFIG.STATES.STONE) color = '#94a3b8';\n  if (p.state === CONFIG.STATES.GIANT_CHARGE || p.state === CONFIG.STATES.GIANT_SLAM)\n    color = '#fbbf24';\n  if (p.invulnerable > 0 && Math.floor(p.invulnerable / 50) % 2 === 0) {\n    ctx.globalAlpha = 0.5;\n  }\n  const scale = p.state === CONFIG.STATES.GIANT_CHARGE\n    ? 1 + (1 - p.stateTimer / CONFIG.GIANT_CHARGE_MS) * 0.5\n    : p.state === CONFIG.STATES.GIANT_SLAM\n      ? 1.5 - (1 - p.stateTimer / CONFIG.GIANT_SLAM_MS) * 0.5\n      : 1;\n  drawBlob(ctx, p.x, p.y, p.radius * scale, color);\n  ctx.globalAlpha = 1;\n\n  // Spin effect\n  if (p.state === CONFIG.STATES.SPIN) {\n    ctx.strokeStyle = 'rgba(168,85,247,0.6)';\n    ctx.lineWidth = 4;\n    ctx.beginPath();\n    ctx.arc(p.x, p.y, CONFIG.SPIN_AOE_RADIUS, 0, Math.PI * 2);\n    ctx.stroke();\n  }\n\n  ctx.restore();\n}\n","/**\n * UI - HP bar, Energy gauge, state debug, cooldown indicators, restart\n */\n\nimport { CONFIG } from './config';\nimport { GameState } from './game';\n\nconst STATE_NAMES: Record<number, string> = {\n  [CONFIG.STATES.IDLE]: 'IDLE',\n  [CONFIG.STATES.MOVE]: 'MOVE',\n  [CONFIG.STATES.ATTACK]: 'ATTACK',\n  [CONFIG.STATES.HYPER]: 'HYPER',\n  [CONFIG.STATES.SPIN]: 'SPIN',\n  [CONFIG.STATES.GIANT_CHARGE]: 'GIANT_CHARGE',\n  [CONFIG.STATES.GIANT_SLAM]: 'GIANT_SLAM',\n  [CONFIG.STATES.STONE]: 'STONE',\n  [CONFIG.STATES.DOWN]: 'DOWN',\n  [CONFIG.STATES.HITSTUN]: 'HITSTUN',\n};\n\nfunction $(id: string): HTMLElement | null {\n  return document.getElementById(id);\n}\n\nfunction formatMs(ms: number): string {\n  if (ms <= 0) return 'OK';\n  return (ms / 1000).toFixed(1) + 's';\n}\n\nexport function updateUI(gs: GameState): void {\n  const p = gs.player;\n\n  const hpBar = $('hpBar');\n  const hpVal = $('hpValue');\n  const energyBar = $('energyBar');\n  const energyVal = $('energyVal');\n  const stateText = $('stateText');\n  const cdMultiply = $('cdMultiply');\n  const cdStone = $('cdStone');\n  const cdHyper = $('cdHyper');\n  const cdGiant = $('cdGiant');\n  const cdSpin = $('cdSpin');\n  const gameTimeEl = $('gameTime');\n  const enemiesEl = $('enemiesCount');\n  const winOverlay = $('winOverlay');\n  const loseOverlay = $('loseOverlay');\n  const btnRestart = $('btnRestart');\n\n  if (hpBar && hpVal) {\n    const pct = (p.hp / p.maxHp) * 100;\n    hpBar.style.width = pct + '%';\n    hpVal.textContent = Math.floor(p.hp) + ' / ' + Math.floor(p.maxHp);\n  }\n\n  if (energyBar && energyVal) {\n    const pct = (p.energy / CONFIG.ENERGY_MAX) * 100;\n    energyBar.style.width = pct + '%';\n    energyVal.textContent = Math.floor(p.energy) + ' / ' + CONFIG.ENERGY_MAX;\n  }\n\n  if (stateText) {\n    stateText.textContent = STATE_NAMES[p.state] || '?';\n  }\n\n  if (cdMultiply) cdMultiply.textContent = formatMs(p.cooldownMultiply);\n  if (cdStone) cdStone.textContent = formatMs(p.cooldownStone);\n  if (cdHyper) cdHyper.textContent = formatMs(p.cooldownHyper);\n  if (cdGiant) cdGiant.textContent = formatMs(p.cooldownGiant);\n  if (cdSpin) cdSpin.textContent = formatMs(p.cooldownSpin);\n\n  if (gameTimeEl) {\n    const sec = Math.floor(gs.gameTime / 1000);\n    gameTimeEl.textContent = sec + 's';\n  }\n\n  if (enemiesEl) {\n    enemiesEl.textContent = gs.enemiesDefeated + ' / ' + CONFIG.ENEMIES_TO_DEFEAT;\n  }\n\n  if (winOverlay) {\n    winOverlay.style.display = gs.phase === 'won' ? 'flex' : 'none';\n  }\n\n  if (loseOverlay) {\n    loseOverlay.style.display = gs.phase === 'lost' ? 'flex' : 'none';\n  }\n\n  if (btnRestart && (gs.phase === 'won' || gs.phase === 'lost')) {\n    btnRestart.onclick = () => window.location.reload();\n  }\n}\n","/**\n * PuniPuni Arena - Main game loop and state machine\n * Fixed timestep 60Hz, gesture handling, combat, win/lose\n */\n\nimport { CONFIG } from './config';\nimport {\n  PuniPuni,\n  createPuniPuni,\n  computeDamage,\n  distance,\n  isPointInCircle,\n  Clone,\n} from './character';\nimport { Enemy, createEnemy, updateEnemy, clampToArena, circlesOverlap } from './enemy';\nimport {\n  GestureState,\n  createGestureState,\n  recordClick,\n  checkDoubleClick,\n  setLastClick,\n  pointerDown,\n  pointerMove,\n  pointerUp,\n  GestureResult,\n} from './gesture';\nimport { getPointerPosition, createInputState, InputState } from './input';\nimport { draw } from './render';\nimport { updateUI } from './ui';\n\nconst FIXED_DT = CONFIG.FIXED_DT_MS;\n\nexport type GamePhase = 'playing' | 'won' | 'lost';\n\nexport interface GameState {\n  phase: GamePhase;\n  player: PuniPuni;\n  enemies: Enemy[];\n  gesture: GestureState;\n  input: InputState;\n  canvas: HTMLCanvasElement;\n  ctx: CanvasRenderingContext2D;\n  lastTime: number;\n  accumulator: number;\n  gameTime: number;\n  enemiesDefeated: number;\n  screenShake: number;\n  hitFlash: number;\n}\n\nexport function createGame(canvas: HTMLCanvasElement): GameState {\n  const ctx = canvas.getContext('2d');\n  if (!ctx) throw new Error('Could not get 2D context');\n\n  return {\n    phase: 'playing',\n    player: createPuniPuni(),\n    enemies: [] as Enemy[],\n    gesture: createGestureState(),\n    input: createInputState(),\n    canvas,\n    ctx,\n    lastTime: 0,\n    accumulator: 0,\n    gameTime: 0,\n    enemiesDefeated: 0,\n    screenShake: 0,\n    hitFlash: 0,\n  };\n}\n\nfunction canAcceptInput(p: PuniPuni): boolean {\n  return (\n    p.state !== CONFIG.STATES.HITSTUN &&\n    p.state !== CONFIG.STATES.DOWN\n  );\n}\n\nfunction tickCooldowns(p: PuniPuni, dt: number): void {\n  if (p.cooldownStone > 0) p.cooldownStone -= dt;\n  if (p.cooldownHyper > 0) p.cooldownHyper -= dt;\n  if (p.cooldownMultiply > 0) p.cooldownMultiply -= dt;\n  if (p.cooldownSpin > 0) p.cooldownSpin -= dt;\n  if (p.cooldownGiant > 0) p.cooldownGiant -= dt;\n}\n\nfunction updatePlayerState(p: PuniPuni, dt: number): void {\n  if (p.invulnerable > 0) p.invulnerable -= dt;\n\n  tickCooldowns(p, dt);\n\n  // State timers (skip for ATTACK - handled below)\n  if (p.state !== CONFIG.STATES.ATTACK && p.stateTimer > 0) {\n    p.stateTimer -= dt;\n    if (p.stateTimer <= 0) {\n      if (p.state === CONFIG.STATES.HITSTUN) {\n        p.state = CONFIG.STATES.DOWN;\n        p.stateTimer = CONFIG.DOWN_MS;\n      } else if (p.state === CONFIG.STATES.DOWN) {\n        p.state = CONFIG.STATES.IDLE;\n      } else if (p.state === CONFIG.STATES.STONE) {\n        p.state = CONFIG.STATES.IDLE;\n        p.stoneDefBoost = 1;\n        p.stoneSpeedMult = 1;\n        p.cooldownStone = CONFIG.STONE_COOLDOWN_MS;\n      } else if (p.state === CONFIG.STATES.HYPER) {\n        p.state = CONFIG.STATES.IDLE;\n        p.cooldownHyper = CONFIG.HYPER_COOLDOWN_MS;\n      } else if (p.state === CONFIG.STATES.SPIN) {\n        p.state = CONFIG.STATES.IDLE;\n        p.cooldownSpin = CONFIG.SPIN_COOLDOWN_MS;\n      } else if (p.state === CONFIG.STATES.GIANT_SLAM) {\n        p.state = CONFIG.STATES.IDLE;\n        p.cooldownGiant = CONFIG.GIANT_COOLDOWN_MS;\n      }\n    }\n  }\n\n  // Attack phase\n  if (p.attackPhase !== 'idle' && p.state === CONFIG.STATES.ATTACK) {\n    p.stateTimer -= dt;\n    if (p.attackPhase === 'startup' && p.stateTimer <= 0) {\n      p.attackPhase = 'active';\n      p.attackHitDealt = false;\n      p.stateTimer = CONFIG.ATTACK_ACTIVE_MS;\n    } else if (p.attackPhase === 'active' && p.stateTimer <= 0) {\n      p.attackPhase = 'recovery';\n      p.stateTimer = CONFIG.ATTACK_RECOVERY_MS;\n    } else if (p.attackPhase === 'recovery' && p.stateTimer <= 0) {\n      p.attackPhase = 'idle';\n      p.state = CONFIG.STATES.IDLE;\n    }\n  }\n}\n\nfunction applyMovement(gs: GameState, p: PuniPuni, dt: number): void {\n  const speed =\n    (CONFIG.CHARACTER_SPEED * p.stoneSpeedMult * (dt / 1000)) * 60;\n  if (gs.input.moveTarget) {\n    const dx = gs.input.moveTarget.x - p.x;\n    const dy = gs.input.moveTarget.y - p.y;\n    const dist = Math.hypot(dx, dy);\n    if (dist > 5) {\n      p.x += (dx / dist) * Math.min(speed, dist);\n      p.y += (dy / dist) * Math.min(speed, dist);\n    } else {\n      gs.input.moveTarget = null;\n    }\n  }\n  p.x = Math.max(p.radius, Math.min(CONFIG.ARENA_WIDTH - p.radius, p.x));\n  p.y = Math.max(p.radius, Math.min(CONFIG.ARENA_HEIGHT - p.radius, p.y));\n}\n\nfunction processGestureResult(\n  gs: GameState,\n  result: GestureResult,\n  now: number\n): void {\n  const p = gs.player;\n  if (result.type === 'none') return;\n  if (!canAcceptInput(p)) return;\n\n  switch (result.type) {\n    case 'move':\n      if (p.state === CONFIG.STATES.IDLE || p.state === CONFIG.STATES.MOVE) {\n        gs.input.moveTarget = { x: result.x, y: result.y };\n        p.state = CONFIG.STATES.MOVE;\n      }\n      break;\n    case 'attack':\n      if (\n        (p.state === CONFIG.STATES.IDLE || p.state === CONFIG.STATES.MOVE) &&\n        p.attackPhase === 'idle'\n      ) {\n        p.state = CONFIG.STATES.ATTACK;\n        p.attackPhase = 'startup';\n        p.stateTimer = CONFIG.ATTACK_STARTUP_MS;\n      }\n      break;\n    case 'double_stone':\n      if (\n        p.state <= CONFIG.STATES.ATTACK &&\n        p.cooldownStone <= 0\n      ) {\n        p.state = CONFIG.STATES.STONE;\n        p.stateTimer = CONFIG.STONE_DURATION_MS;\n        p.invulnerable = CONFIG.STONE_I_FRAMES_MS;\n        p.stoneDefBoost = CONFIG.STONE_DEF_BOOST;\n        p.stoneSpeedMult = CONFIG.STONE_SPEED_MULT;\n      }\n      break;\n    case 'double_hyper':\n      if (\n        p.state <= CONFIG.STATES.ATTACK &&\n        p.cooldownHyper <= 0 &&\n        p.energy >= CONFIG.HYPER_ENERGY_COST\n      ) {\n        p.energy -= CONFIG.HYPER_ENERGY_COST;\n        p.hyperDamageDealt = false;\n        const dx = result.x - p.x;\n        const dy = result.y - p.y;\n        const dist = Math.hypot(dx, dy) || 1;\n        p.hyperDirX = (dx / dist) * CONFIG.HYPER_DASH_SPEED;\n        p.hyperDirY = (dy / dist) * CONFIG.HYPER_DASH_SPEED;\n        p.state = CONFIG.STATES.HYPER;\n        p.stateTimer = CONFIG.HYPER_DURATION_MS;\n      }\n      break;\n    case 'multiply':\n      if (p.state <= CONFIG.STATES.ATTACK && p.cooldownMultiply <= 0) {\n        const n =\n          CONFIG.MULTIPLY_CLONE_COUNT_MIN +\n          Math.floor(\n            Math.random() *\n              (CONFIG.MULTIPLY_CLONE_COUNT_MAX - CONFIG.MULTIPLY_CLONE_COUNT_MIN + 1)\n          );\n        for (let i = 0; i < n; i++) {\n          const angle = (Math.PI * 2 * i) / n + Math.random() * 0.5;\n          p.clones.push({\n            x: p.x + Math.cos(angle) * 40,\n            y: p.y + Math.sin(angle) * 40,\n            radius: CONFIG.MULTIPLY_CLONE_RADIUS,\n            lifetime: CONFIG.MULTIPLY_CLONE_LIFETIME_MS,\n            maxLifetime: CONFIG.MULTIPLY_CLONE_LIFETIME_MS,\n            lastAttackTime: 0,\n          });\n        }\n        p.cooldownMultiply = CONFIG.MULTIPLY_COOLDOWN_MS;\n      }\n      break;\n    case 'spin':\n      if (\n        p.state <= CONFIG.STATES.ATTACK &&\n        p.state !== CONFIG.STATES.SPIN &&\n        p.cooldownSpin <= 0\n      ) {\n        p.state = CONFIG.STATES.SPIN;\n        p.stateTimer = CONFIG.SPIN_DURATION_MS;\n        p.spinAngle = 0;\n      }\n      break;\n    case 'giant_charge':\n      if (\n        p.state <= CONFIG.STATES.ATTACK &&\n        p.state !== CONFIG.STATES.GIANT_CHARGE &&\n        p.cooldownGiant <= 0\n      ) {\n        p.state = CONFIG.STATES.GIANT_CHARGE;\n        p.stateTimer = CONFIG.GIANT_CHARGE_MS;\n        p.giantScale = 1;\n        p.giantDamageDealt = false;\n      }\n      break;\n    case 'giant_release':\n      if (p.state === CONFIG.STATES.GIANT_CHARGE) {\n        p.state = CONFIG.STATES.GIANT_SLAM;\n        p.stateTimer = CONFIG.GIANT_SLAM_MS;\n        p.giantSlamY = p.y;\n      }\n      break;\n  }\n}\n\nfunction fixedUpdate(gs: GameState): void {\n  const p = gs.player;\n  const dt = FIXED_DT;\n\n  // Hyper dash movement\n  if (p.state === CONFIG.STATES.HYPER) {\n    p.x += p.hyperDirX * (dt / 1000) * 60;\n    p.y += p.hyperDirY * (dt / 1000) * 60;\n    p.x = Math.max(p.radius, Math.min(CONFIG.ARENA_WIDTH - p.radius, p.x));\n    p.y = Math.max(p.radius, Math.min(CONFIG.ARENA_HEIGHT - p.radius, p.y));\n  }\n  // Stone / Idle / Move / other: allow movement\n  else if (\n    p.state === CONFIG.STATES.IDLE ||\n    p.state === CONFIG.STATES.MOVE ||\n    p.state === CONFIG.STATES.STONE\n  ) {\n    applyMovement(gs, p, dt);\n  }\n\n  // Spin - damage enemies in radius every SPIN_TICK_MS\n  if (p.state === CONFIG.STATES.SPIN) {\n    p.spinAngle += (360 / CONFIG.SPIN_DURATION_MS) * dt;\n    if (gs.gameTime - p.spinLastDamageTime >= CONFIG.SPIN_TICK_MS) {\n      p.spinLastDamageTime = gs.gameTime;\n      gs.enemies.forEach((e) => {\n      if (distance(p.x, p.y, e.x, e.y) <= CONFIG.SPIN_AOE_RADIUS) {\n        const dmg = computeDamage(\n          p.atk,\n          e.def,\n          p.condition,\n          CONFIG.SPIN_MULTIPLIER\n        );\n        e.hp -= dmg;\n        if (e.hp <= 0) {\n          gs.enemiesDefeated++;\n          p.energy = Math.min(\n            CONFIG.ENERGY_MAX,\n            p.energy + CONFIG.ENERGY_GAIN_PER_HIT\n          );\n        }\n      }\n    });\n    }\n  }\n\n  // Giant slam - damage once at midpoint\n  if (\n    p.state === CONFIG.STATES.GIANT_SLAM &&\n    p.stateTimer <= CONFIG.GIANT_SLAM_MS * 0.5 &&\n    !p.giantDamageDealt\n  ) {\n    p.giantDamageDealt = true;\n    const dmgMult = CONFIG.GIANT_MULTIPLIER;\n    gs.enemies.forEach((e) => {\n      if (distance(p.x, p.y, e.x, e.y) <= CONFIG.GIANT_AOE_RADIUS) {\n        const dmg = computeDamage(p.atk, e.def, p.condition, dmgMult);\n        e.hp -= dmg;\n        if (e.hp <= 0) {\n          gs.enemiesDefeated++;\n          p.energy = Math.min(\n            CONFIG.ENERGY_MAX,\n            p.energy + CONFIG.ENERGY_GAIN_PER_HIT\n          );\n        }\n      }\n    });\n  }\n\n  // Attack active - damage enemies in range (once per attack)\n  if (p.attackPhase === 'active' && !p.attackHitDealt) {\n    p.attackHitDealt = true;\n    gs.enemies.forEach((e) => {\n      if (distance(p.x, p.y, e.x, e.y) <= CONFIG.ATTACK_RANGE + e.radius) {\n        const dmg = computeDamage(\n          p.atk,\n          e.def,\n          p.condition,\n          CONFIG.ATTACK_MULTIPLIER\n        );\n        e.hp -= dmg;\n        if (e.hp <= 0) {\n          gs.enemiesDefeated++;\n          p.energy = Math.min(\n            CONFIG.ENERGY_MAX,\n            p.energy + CONFIG.ENERGY_GAIN_PER_HIT\n          );\n        }\n      }\n    });\n    // Clones assist\n    p.clones.forEach((c) => {\n      const nearest = gs.enemies.reduce<Enemy | null>((a, e) => {\n        if (e.hp <= 0) return a;\n        const d = distance(c.x, c.y, e.x, e.y);\n        if (!a || d < distance(c.x, c.y, a.x, a.y)) return e;\n        return a;\n      }, null);\n      if (nearest && distance(c.x, c.y, nearest.x, nearest.y) < 50) {\n        const now = gs.gameTime;\n        if (now - c.lastAttackTime > 500) {\n          const dmg = Math.floor(\n            computeDamage(p.atk, nearest.def, p.condition, CONFIG.MULTIPLY_CLONE_DAMAGE_MULT)\n          );\n          nearest.hp -= dmg;\n          c.lastAttackTime = now;\n          if (nearest.hp <= 0) gs.enemiesDefeated++;\n        }\n      }\n    });\n  }\n\n  // Hyper - damage at end of dash (once)\n  if (p.state === CONFIG.STATES.HYPER && p.stateTimer <= 50 && !p.hyperDamageDealt) {\n    p.hyperDamageDealt = true;\n    gs.enemies.forEach((e) => {\n      if (distance(p.x, p.y, e.x, e.y) <= CONFIG.HYPER_AOE_RADIUS) {\n        const dmg = computeDamage(\n          p.atk,\n          e.def,\n          p.condition,\n          CONFIG.HYPER_MULTIPLIER\n        );\n        e.hp -= dmg;\n        if (e.hp <= 0) {\n          gs.enemiesDefeated++;\n          p.energy = Math.min(\n            CONFIG.ENERGY_MAX,\n            p.energy + CONFIG.ENERGY_GAIN_PER_HIT\n          );\n        }\n      }\n    });\n  }\n\n  // Update clones\n  p.clones = p.clones.filter((c) => {\n    c.lifetime -= dt;\n    if (c.lifetime <= 0) return false;\n    const nearest = gs.enemies.find(\n      (e) => e.hp > 0 && distance(c.x, c.y, e.x, e.y) < 150\n    );\n    if (nearest) {\n      const dx = nearest.x - c.x;\n      const dy = nearest.y - c.y;\n      const dist = Math.hypot(dx, dy) || 1;\n      const spd = 3 * (dt / 1000) * 60;\n      c.x += (dx / dist) * Math.min(spd, dist);\n      c.y += (dy / dist) * Math.min(spd, dist);\n    }\n    return true;\n  });\n\n  // Enemies\n  gs.enemies.forEach((e) => updateEnemy(e, p.x, p.y, dt));\n  gs.enemies.forEach(clampToArena);\n  gs.enemies = gs.enemies.filter((e) => e.hp > 0);\n\n  // Enemy contact damage\n  gs.enemies.forEach((e) => {\n    if (\n      circlesOverlap(p.x, p.y, p.radius, e.x, e.y, e.radius) &&\n      e.damageCooldown <= 0 &&\n      p.invulnerable <= 0\n    ) {\n      const def = p.def * p.stoneDefBoost;\n      const dmg = computeDamage(e.atk, def, 1, 1);\n      p.hp -= dmg;\n      e.damageCooldown = CONFIG.ENEMY_DAMAGE_COOLDOWN_MS;\n      const dx = p.x - e.x;\n      const dy = p.y - e.y;\n      const dist = Math.hypot(dx, dy) || 1;\n      p.vx = (dx / dist) * CONFIG.PLAYER_KNOCKBACK;\n      p.vy = (dy / dist) * CONFIG.PLAYER_KNOCKBACK;\n      p.state = CONFIG.STATES.HITSTUN;\n      p.stateTimer = CONFIG.HITSTUN_MS;\n      p.invulnerable = CONFIG.HITSTUN_MS;\n      gs.screenShake = CONFIG.SCREEN_SHAKE_AMOUNT;\n      gs.hitFlash = CONFIG.HIT_FLASH_MS;\n      if (p.hp <= 0) gs.phase = 'lost';\n    }\n  });\n\n  // Apply knockback\n  if (p.vx !== 0 || p.vy !== 0) {\n    p.x += p.vx * (dt / 1000) * 60;\n    p.y += p.vy * (dt / 1000) * 60;\n    p.vx *= 0.85;\n    p.vy *= 0.85;\n    p.x = Math.max(p.radius, Math.min(CONFIG.ARENA_WIDTH - p.radius, p.x));\n    p.y = Math.max(p.radius, Math.min(CONFIG.ARENA_HEIGHT - p.radius, p.y));\n  }\n\n  updatePlayerState(p, dt);\n  gs.gameTime += dt;\n\n  if (p.energy < CONFIG.ENERGY_MAX)\n    p.energy = Math.min(\n      CONFIG.ENERGY_MAX,\n      p.energy + CONFIG.ENERGY_DECAY_RATE * (dt / 1000) * 60\n    );\n}\n\nfunction spawnEnemy(gs: GameState): void {\n  const angle = Math.random() * Math.PI * 2;\n  const dist = 250 + Math.random() * 100;\n  const x =\n    CONFIG.ARENA_WIDTH / 2 + Math.cos(angle) * dist;\n  const y =\n    CONFIG.ARENA_HEIGHT / 2 + Math.sin(angle) * dist;\n  gs.enemies.push(createEnemy(x, y));\n}\n\nexport function setupInput(gs: GameState): void {\n  const canvas = gs.canvas;\n  const p = gs.player;\n\n  canvas.addEventListener(\n    'pointerdown',\n    (e: PointerEvent) => {\n      e.preventDefault();\n      const { x, y } = getPointerPosition(e, canvas);\n      const onChar = isPointInCircle(x, y, p.x, p.y, p.radius + 10);\n      const now = performance.now();\n\n      if (CONFIG.POINTER_CAPTURE_ENABLED) {\n        canvas.setPointerCapture(e.pointerId);\n      }\n\n      pointerDown(gs.gesture, x, y, p.x, p.y, p.radius, now);\n\n      const double = checkDoubleClick(gs.gesture, x, y, onChar, now);\n      if (double.type !== 'none') {\n        processGestureResult(gs, double, now);\n        return;\n      }\n\n      const multiply = recordClick(gs.gesture, x, y, onChar, now);\n      if (multiply.type !== 'none') {\n        processGestureResult(gs, multiply, now);\n        return;\n      }\n\n      if (onChar && canAcceptInput(p)) {\n        processGestureResult(gs, { type: 'attack' }, now);\n      } else {\n        processGestureResult(gs, { type: 'move', x, y }, now);\n      }\n    },\n    { passive: false }\n  );\n\n  canvas.addEventListener(\n    'pointermove',\n    (e: PointerEvent) => {\n      const { x, y } = getPointerPosition(e, canvas);\n      const { spin, giantCharge } = pointerMove(\n        gs.gesture,\n        x,\n        y,\n        p.x,\n        p.y,\n        p.radius,\n        performance.now()\n      );\n      if (spin) processGestureResult(gs, { type: 'spin' }, performance.now());\n      if (giantCharge)\n        processGestureResult(gs, { type: 'giant_charge' }, performance.now());\n    },\n    { passive: true }\n  );\n\n  canvas.addEventListener(\n    'pointerup',\n    (e: PointerEvent) => {\n      const { x, y } = getPointerPosition(e, canvas);\n      const onChar = isPointInCircle(x, y, p.x, p.y, p.radius + 10);\n      const now = performance.now();\n      if (\n        gs.gesture.pointerDownOnChar &&\n        gs.player.state === CONFIG.STATES.GIANT_CHARGE\n      ) {\n        processGestureResult(gs, { type: 'giant_release' }, now);\n      }\n      setLastClick(gs.gesture, x, y, onChar, now);\n      pointerUp(gs.gesture);\n    },\n    { passive: true }\n  );\n\n  canvas.addEventListener(\n    'contextmenu',\n    (e) => e.preventDefault(),\n    { passive: false }\n  );\n}\n\nlet lastSpawnTime = 0;\n\nexport function gameLoop(gs: GameState, time: number): void {\n  const delta = time - gs.lastTime;\n  gs.lastTime = time;\n\n  gs.accumulator += Math.min(delta, 250);\n  while (gs.accumulator >= FIXED_DT && gs.phase === 'playing') {\n    fixedUpdate(gs);\n    gs.accumulator -= FIXED_DT;\n\n    if (gs.gameTime - lastSpawnTime >= CONFIG.ENEMY_SPAWN_INTERVAL_MS) {\n      spawnEnemy(gs);\n      lastSpawnTime = gs.gameTime;\n    }\n\n    if (\n      gs.gameTime >= CONFIG.SURVIVAL_TIME_MS ||\n      gs.enemiesDefeated >= CONFIG.ENEMIES_TO_DEFEAT\n    ) {\n      gs.phase = 'won';\n    }\n  }\n\n  if (gs.screenShake > 0) gs.screenShake -= 2;\n  if (gs.hitFlash > 0) gs.hitFlash -= 16;\n\n  draw(gs);\n  updateUI(gs);\n  requestAnimationFrame((t) => gameLoop(gs, t));\n}\n","/**\n * PuniPuni Arena - Entry point\n * Tap/click-based real-time action with gesture recognition\n */\n\nimport { createGame, setupInput, gameLoop } from './game';\n\nfunction init(): void {\n  const canvas = document.getElementById('gameCanvas') as HTMLCanvasElement;\n  if (!canvas) {\n    console.error('Canvas not found');\n    return;\n  }\n\n  const gs = createGame(canvas);\n  setupInput(gs);\n  requestAnimationFrame((t) => gameLoop(gs, t));\n}\n\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', init);\n} else {\n  init();\n}\n"],"names":["CONFIG","createPuniPuni","computeDamage","atk","def","condition","skillMultiplier","raw","base","rand","distance","x1","y1","x2","y2","isPointInCircle","px","py","cx","cy","r","nextId","createEnemy","x","y","updateEnemy","enemy","playerX","playerY","dt","dist","dx","dy","clampToArena","e","circlesOverlap","r1","r2","createGestureState","recordClick","g","onChar","now","cutoff","c","onCharClicks","checkDoubleClick","sameSpot","setLastClick","pointerDown","charX","charY","charR","pointerMove","angle","delta","holdTime","spinOk","giantOk","pointerUp","createInputState","getPointerPosition","canvas","rect","scaleX","scaleY","drawBlob","ctx","radius","color","alpha","draw","gs","p","shakeX","shakeY","barW","barH","t","scale","STATE_NAMES","$","id","formatMs","ms","updateUI","hpBar","hpVal","energyBar","energyVal","stateText","cdMultiply","cdStone","cdHyper","cdGiant","cdSpin","gameTimeEl","enemiesEl","winOverlay","loseOverlay","btnRestart","pct","sec","FIXED_DT","createGame","canAcceptInput","tickCooldowns","updatePlayerState","applyMovement","speed","processGestureResult","result","n","i","fixedUpdate","dmg","dmgMult","nearest","a","d","spd","spawnEnemy","setupInput","double","multiply","spin","giantCharge","lastSpawnTime","gameLoop","time","init"],"mappings":"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"}