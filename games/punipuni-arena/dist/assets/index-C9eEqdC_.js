(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const T of r.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&n(T)}).observe(document,{childList:!0,subtree:!0});function o(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=o(i);fetch(i.href,r)}})();const a={FIXED_DT_MS:1e3/60,ARENA_WIDTH:800,ARENA_HEIGHT:600,ARENA_PADDING:40,CHARACTER_RADIUS:28,CHARACTER_HP:100,CHARACTER_ATK:12,CHARACTER_DEF:5,CHARACTER_SPEED:4,CHARACTER_CONDITION:1,ENERGY_MAX:100,ENERGY_GAIN_PER_HIT:5,ENERGY_DECAY_RATE:.2,DAMAGE_DEF_MULT:.7,DAMAGE_RAND_MIN:.9,DAMAGE_RAND_MAX:1.1,STATES:{IDLE:0,MOVE:1,ATTACK:2,HYPER:3,SPIN:4,GIANT_CHARGE:5,GIANT_SLAM:6,STONE:7,DOWN:8,HITSTUN:9},ATTACK_STARTUP_MS:80,ATTACK_ACTIVE_MS:100,ATTACK_RECOVERY_MS:120,ATTACK_MULTIPLIER:1,ATTACK_RANGE:70,STONE_I_FRAMES_MS:200,STONE_DURATION_MS:2500,STONE_DEF_BOOST:2,STONE_SPEED_MULT:.3,STONE_COOLDOWN_MS:8e3,HYPER_ENERGY_COST:50,HYPER_COOLDOWN_MS:5e3,HYPER_DASH_SPEED:18,HYPER_DURATION_MS:400,HYPER_MULTIPLIER:2.5,HYPER_AOE_RADIUS:80,MULTIPLY_CLICKS_NEEDED:6,MULTIPLY_TIME_WINDOW_MS:800,MULTIPLY_CLONE_COUNT_MIN:2,MULTIPLY_CLONE_COUNT_MAX:5,MULTIPLY_COOLDOWN_MS:1e4,MULTIPLY_CLONE_LIFETIME_MS:6e3,MULTIPLY_CLONE_DAMAGE_MULT:.3,MULTIPLY_CLONE_RADIUS:16,SPIN_ANGLE_THRESHOLD_DEG:300,SPIN_TIME_WINDOW_MS:700,SPIN_DURATION_MS:1200,SPIN_TICK_MS:100,SPIN_MULTIPLIER:.6,SPIN_AOE_RADIUS:100,SPIN_COOLDOWN_MS:6e3,GIANT_HOLD_THRESHOLD_MS:150,GIANT_CHARGE_MS:600,GIANT_SLAM_MS:400,GIANT_AOE_RADIUS:120,GIANT_MULTIPLIER:3,GIANT_COOLDOWN_MS:12e3,DOUBLE_CLICK_THRESHOLD_MS:250,SPIN_MIN_DISTANCE:20,GIANT_MIN_VERTICAL:40,ENEMY_SPAWN_INTERVAL_MS:3e3,ENEMY_HP:30,ENEMY_ATK:8,ENEMY_DEF:2,ENEMY_RADIUS:20,ENEMY_SPEED:2,ENEMY_DAMAGE_COOLDOWN_MS:800,ENEMIES_TO_DEFEAT:15,SURVIVAL_TIME_MS:6e4,PLAYER_KNOCKBACK:60,HITSTUN_MS:400,DOWN_MS:800,SCREEN_SHAKE_AMOUNT:4,HIT_FLASH_MS:80};function G(){return{x:a.ARENA_WIDTH/2,y:a.ARENA_HEIGHT/2,vx:0,vy:0,radius:a.CHARACTER_RADIUS,hp:a.CHARACTER_HP,maxHp:a.CHARACTER_HP,atk:a.CHARACTER_ATK,def:a.CHARACTER_DEF,condition:a.CHARACTER_CONDITION,energy:0,state:a.STATES.IDLE,stateTimer:0,invulnerable:0,cooldownStone:0,cooldownHyper:0,cooldownMultiply:0,cooldownSpin:0,cooldownGiant:0,attackPhase:"idle",attackHitDealt:!1,attackTargetX:0,attackTargetY:0,stoneDefBoost:1,stoneSpeedMult:1,hyperDirX:0,hyperDirY:0,hyperDamageDealt:!1,spinAngle:0,spinLastDamageTime:0,giantScale:1,giantSlamY:0,giantDamageDealt:!1,clones:[]}}function M(t,e,o,n){const i=t*n*o-e*a.DAMAGE_DEF_MULT,r=Math.max(1,i),T=a.DAMAGE_RAND_MIN+Math.random()*(a.DAMAGE_RAND_MAX-a.DAMAGE_RAND_MIN);return Math.max(1,Math.floor(r*T))}function c(t,e,o,n){return Math.hypot(o-t,n-e)}function L(t,e,o,n,i){return c(t,e,o,n)<=i}let x=1;function Y(t,e){return{id:x++,x:t,y:e,vx:0,vy:0,radius:a.ENEMY_RADIUS,hp:a.ENEMY_HP,maxHp:a.ENEMY_HP,atk:a.ENEMY_ATK,def:a.ENEMY_DEF,speed:a.ENEMY_SPEED,damageCooldown:0}}function v(t,e,o,n){const i=c(t.x,t.y,e,o);if(i>0){const r=(e-t.x)/i,T=(o-t.y)/i;t.vx=r*t.speed,t.vy=T*t.speed,t.x+=t.vx*(n/1e3)*60,t.y+=t.vy*(n/1e3)*60}t.damageCooldown>0&&(t.damageCooldown-=n)}function w(t){const e=a.ARENA_PADDING+t.radius;t.x=Math.max(e,Math.min(a.ARENA_WIDTH-e,t.x)),t.y=Math.max(e,Math.min(a.ARENA_HEIGHT-e,t.y))}function U(t,e,o,n,i,r){return c(t,e,n,i)<o+r}function k(){return{clickHistory:[],pointerDownTime:0,pointerDownX:0,pointerDownY:0,pointerDownOnChar:!1,lastAngle:0,cumulativeAngle:0,lastMoveTime:0,verticalStartY:0,verticalMoved:!1,lastClickTime:0,lastClickX:0,lastClickY:0,lastClickOnChar:!1}}function b(t,e,o,n,i){t.clickHistory.push({time:i,x:e,y:o,onChar:n});const r=i-a.MULTIPLY_TIME_WINDOW_MS;t.clickHistory=t.clickHistory.filter(E=>E.time>r);const T=t.clickHistory.filter(E=>E.onChar);return T.length>=a.MULTIPLY_CLICKS_NEEDED&&T[T.length-1].time-T[0].time<=a.MULTIPLY_TIME_WINDOW_MS?(t.clickHistory=[],{type:"multiply"}):{type:"none"}}function K(t,e,o,n,i){const r=i-t.lastClickTime,T=c(e,o,t.lastClickX,t.lastClickY)<50;return r<=a.DOUBLE_CLICK_THRESHOLD_MS&&T&&r>0?n?{type:"double_stone"}:{type:"double_hyper",x:e,y:o}:{type:"none"}}function W(t,e,o,n,i){t.lastClickTime=i,t.lastClickX=e,t.lastClickY=o,t.lastClickOnChar=n}function g(t,e,o,n,i,r,T){t.pointerDownTime=T,t.pointerDownX=e,t.pointerDownY=o,t.pointerDownOnChar=c(e,o,n,i)<=r+10,t.lastAngle=Math.atan2(o-i,e-n),t.cumulativeAngle=0,t.lastMoveTime=T,t.verticalStartY=o,t.verticalMoved=!1}function F(t,e,o,n,i,r,T){if(!t.pointerDownOnChar)return{spin:!1,giantCharge:!1};if(c(e,o,n,i)<a.SPIN_MIN_DISTANCE)return{spin:!1,giantCharge:!1};const s=Math.atan2(o-i,e-n);let l=s-t.lastAngle;l>Math.PI&&(l-=Math.PI*2),l<-Math.PI&&(l+=Math.PI*2),t.cumulativeAngle+=Math.abs(l)*(180/Math.PI),t.lastAngle=s,Math.abs(o-t.verticalStartY)>=a.GIANT_MIN_VERTICAL&&(t.verticalMoved=!0);const f=T-t.pointerDownTime,d=t.cumulativeAngle>=a.SPIN_ANGLE_THRESHOLD_DEG&&f<=a.SPIN_TIME_WINDOW_MS,u=f>=a.GIANT_HOLD_THRESHOLD_MS&&t.verticalMoved;return{spin:d,giantCharge:u}}function X(t){t.pointerDownTime=0}function V(){return{pointers:new Map,lastClickTime:0,lastClickX:0,lastClickY:0,lastClickOnCharacter:!1,moveTarget:null,captureActive:!1}}function m(t,e){const o=e.getBoundingClientRect(),n=e.width/o.width,i=e.height/o.height;return{x:(t.clientX-o.left)*n,y:(t.clientY-o.top)*i}}function h(t,e,o,n,i,r=1){t.save(),t.globalAlpha=r,t.fillStyle=i,t.beginPath(),t.arc(e,o,n,0,Math.PI*2),t.fill(),t.strokeStyle="rgba(255,255,255,0.5)",t.lineWidth=2,t.stroke(),t.restore()}function B(t){const e=t.ctx,o=t.canvas,n=t.player,i=(Math.random()-.5)*t.screenShake*2,r=(Math.random()-.5)*t.screenShake*2;e.save(),e.translate(i,r),t.hitFlash>0&&(e.fillStyle=`rgba(255,80,80,${t.hitFlash/a.HIT_FLASH_MS})`,e.fillRect(0,0,o.width,o.height)),e.fillStyle="#0f0f1e",e.fillRect(0,0,o.width,o.height),e.strokeStyle="#4a3a6a",e.lineWidth=4,e.strokeRect(a.ARENA_PADDING/2,a.ARENA_PADDING/2,a.ARENA_WIDTH-a.ARENA_PADDING,a.ARENA_HEIGHT-a.ARENA_PADDING),t.enemies.forEach(s=>{h(e,s.x,s.y,s.radius,"#f59e0b");const l=s.radius*2,_=4;e.fillStyle="#333",e.fillRect(s.x-l/2,s.y-s.radius-10,l,_),e.fillStyle="#22c55e",e.fillRect(s.x-l/2,s.y-s.radius-10,l*(s.hp/s.maxHp),_)}),n.clones.forEach(s=>{const l=s.lifetime/s.maxLifetime;h(e,s.x,s.y,s.radius,"#a78bfa",.5+l*.5)});let T="#60a5fa";n.state===a.STATES.STONE&&(T="#94a3b8"),(n.state===a.STATES.GIANT_CHARGE||n.state===a.STATES.GIANT_SLAM)&&(T="#fbbf24"),n.invulnerable>0&&Math.floor(n.invulnerable/50)%2===0&&(e.globalAlpha=.5);const E=n.state===a.STATES.GIANT_CHARGE?1+(1-n.stateTimer/a.GIANT_CHARGE_MS)*.5:n.state===a.STATES.GIANT_SLAM?1.5-(1-n.stateTimer/a.GIANT_SLAM_MS)*.5:1;h(e,n.x,n.y,n.radius*E,T),e.globalAlpha=1,n.state===a.STATES.SPIN&&(e.strokeStyle="rgba(168,85,247,0.6)",e.lineWidth=4,e.beginPath(),e.arc(n.x,n.y,a.SPIN_AOE_RADIUS,0,Math.PI*2),e.stroke()),e.restore()}const q={[a.STATES.IDLE]:"IDLE",[a.STATES.MOVE]:"MOVE",[a.STATES.ATTACK]:"ATTACK",[a.STATES.HYPER]:"HYPER",[a.STATES.SPIN]:"SPIN",[a.STATES.GIANT_CHARGE]:"GIANT_CHARGE",[a.STATES.GIANT_SLAM]:"GIANT_SLAM",[a.STATES.STONE]:"STONE",[a.STATES.DOWN]:"DOWN",[a.STATES.HITSTUN]:"HITSTUN"};function A(t){return document.getElementById(t)}function N(t){return t<=0?"OK":(t/1e3).toFixed(1)+"s"}function $(t){const e=t.player,o=A("hpBar"),n=A("hpValue"),i=A("energyBar"),r=A("energyVal"),T=A("stateText"),E=A("cdMultiply"),s=A("cdStone"),l=A("cdHyper"),_=A("cdGiant"),f=A("cdSpin"),d=A("gameTime"),u=A("enemiesCount"),C=A("winOverlay"),y=A("loseOverlay"),R=A("btnRestart");if(o&&n){const I=e.hp/e.maxHp*100;o.style.width=I+"%",n.textContent=Math.floor(e.hp)+" / "+Math.floor(e.maxHp)}if(i&&r){const I=e.energy/a.ENERGY_MAX*100;i.style.width=I+"%",r.textContent=Math.floor(e.energy)+" / "+a.ENERGY_MAX}if(T&&(T.textContent=q[e.state]||"?"),E&&(E.textContent=N(e.cooldownMultiply)),s&&(s.textContent=N(e.cooldownStone)),l&&(l.textContent=N(e.cooldownHyper)),_&&(_.textContent=N(e.cooldownGiant)),f&&(f.textContent=N(e.cooldownSpin)),d){const I=Math.floor(t.gameTime/1e3);d.textContent=I+"s"}u&&(u.textContent=t.enemiesDefeated+" / "+a.ENEMIES_TO_DEFEAT),C&&(C.style.display=t.phase==="won"?"flex":"none"),y&&(y.style.display=t.phase==="lost"?"flex":"none"),R&&(t.phase==="won"||t.phase==="lost")&&(R.onclick=()=>window.location.reload())}const D=a.FIXED_DT_MS;function j(t){const e=t.getContext("2d");if(!e)throw new Error("Could not get 2D context");return{phase:"playing",player:G(),enemies:[],gesture:k(),input:V(),canvas:t,ctx:e,lastTime:0,accumulator:0,gameTime:0,enemiesDefeated:0,screenShake:0,hitFlash:0}}function P(t){return t.state!==a.STATES.HITSTUN&&t.state!==a.STATES.DOWN}function z(t,e){t.cooldownStone>0&&(t.cooldownStone-=e),t.cooldownHyper>0&&(t.cooldownHyper-=e),t.cooldownMultiply>0&&(t.cooldownMultiply-=e),t.cooldownSpin>0&&(t.cooldownSpin-=e),t.cooldownGiant>0&&(t.cooldownGiant-=e)}function J(t,e){t.invulnerable>0&&(t.invulnerable-=e),z(t,e),t.state!==a.STATES.ATTACK&&t.stateTimer>0&&(t.stateTimer-=e,t.stateTimer<=0&&(t.state===a.STATES.HITSTUN?(t.state=a.STATES.DOWN,t.stateTimer=a.DOWN_MS):t.state===a.STATES.DOWN?t.state=a.STATES.IDLE:t.state===a.STATES.STONE?(t.state=a.STATES.IDLE,t.stoneDefBoost=1,t.stoneSpeedMult=1,t.cooldownStone=a.STONE_COOLDOWN_MS):t.state===a.STATES.HYPER?(t.state=a.STATES.IDLE,t.cooldownHyper=a.HYPER_COOLDOWN_MS):t.state===a.STATES.SPIN?(t.state=a.STATES.IDLE,t.cooldownSpin=a.SPIN_COOLDOWN_MS):t.state===a.STATES.GIANT_SLAM&&(t.state=a.STATES.IDLE,t.cooldownGiant=a.GIANT_COOLDOWN_MS))),t.attackPhase!=="idle"&&t.state===a.STATES.ATTACK&&(t.stateTimer-=e,t.attackPhase==="startup"&&t.stateTimer<=0?(t.attackPhase="active",t.attackHitDealt=!1,t.stateTimer=a.ATTACK_ACTIVE_MS):t.attackPhase==="active"&&t.stateTimer<=0?(t.attackPhase="recovery",t.stateTimer=a.ATTACK_RECOVERY_MS):t.attackPhase==="recovery"&&t.stateTimer<=0&&(t.attackPhase="idle",t.state=a.STATES.IDLE))}function Q(t,e,o){const n=a.CHARACTER_SPEED*e.stoneSpeedMult*(o/1e3)*60;if(t.input.moveTarget){const i=t.input.moveTarget.x-e.x,r=t.input.moveTarget.y-e.y,T=Math.hypot(i,r);T>5?(e.x+=i/T*Math.min(n,T),e.y+=r/T*Math.min(n,T)):t.input.moveTarget=null}e.x=Math.max(e.radius,Math.min(a.ARENA_WIDTH-e.radius,e.x)),e.y=Math.max(e.radius,Math.min(a.ARENA_HEIGHT-e.radius,e.y))}function S(t,e,o){const n=t.player;if(e.type!=="none"&&P(n))switch(e.type){case"move":(n.state===a.STATES.IDLE||n.state===a.STATES.MOVE)&&(t.input.moveTarget={x:e.x,y:e.y},n.state=a.STATES.MOVE);break;case"attack":(n.state===a.STATES.IDLE||n.state===a.STATES.MOVE)&&n.attackPhase==="idle"&&(n.state=a.STATES.ATTACK,n.attackPhase="startup",n.stateTimer=a.ATTACK_STARTUP_MS);break;case"double_stone":n.state<=a.STATES.ATTACK&&n.cooldownStone<=0&&(n.state=a.STATES.STONE,n.stateTimer=a.STONE_DURATION_MS,n.invulnerable=a.STONE_I_FRAMES_MS,n.stoneDefBoost=a.STONE_DEF_BOOST,n.stoneSpeedMult=a.STONE_SPEED_MULT);break;case"double_hyper":if(n.state<=a.STATES.ATTACK&&n.cooldownHyper<=0&&n.energy>=a.HYPER_ENERGY_COST){n.energy-=a.HYPER_ENERGY_COST,n.hyperDamageDealt=!1;const i=e.x-n.x,r=e.y-n.y,T=Math.hypot(i,r)||1;n.hyperDirX=i/T*a.HYPER_DASH_SPEED,n.hyperDirY=r/T*a.HYPER_DASH_SPEED,n.state=a.STATES.HYPER,n.stateTimer=a.HYPER_DURATION_MS}break;case"multiply":if(n.state<=a.STATES.ATTACK&&n.cooldownMultiply<=0){const i=a.MULTIPLY_CLONE_COUNT_MIN+Math.floor(Math.random()*(a.MULTIPLY_CLONE_COUNT_MAX-a.MULTIPLY_CLONE_COUNT_MIN+1));for(let r=0;r<i;r++){const T=Math.PI*2*r/i+Math.random()*.5;n.clones.push({x:n.x+Math.cos(T)*40,y:n.y+Math.sin(T)*40,radius:a.MULTIPLY_CLONE_RADIUS,lifetime:a.MULTIPLY_CLONE_LIFETIME_MS,maxLifetime:a.MULTIPLY_CLONE_LIFETIME_MS,lastAttackTime:0})}n.cooldownMultiply=a.MULTIPLY_COOLDOWN_MS}break;case"spin":n.state<=a.STATES.ATTACK&&n.state!==a.STATES.SPIN&&n.cooldownSpin<=0&&(n.state=a.STATES.SPIN,n.stateTimer=a.SPIN_DURATION_MS,n.spinAngle=0);break;case"giant_charge":n.state<=a.STATES.ATTACK&&n.state!==a.STATES.GIANT_CHARGE&&n.cooldownGiant<=0&&(n.state=a.STATES.GIANT_CHARGE,n.stateTimer=a.GIANT_CHARGE_MS,n.giantScale=1,n.giantDamageDealt=!1);break;case"giant_release":n.state===a.STATES.GIANT_CHARGE&&(n.state=a.STATES.GIANT_SLAM,n.stateTimer=a.GIANT_SLAM_MS,n.giantSlamY=n.y);break}}function Z(t){const e=t.player,o=D;if(e.state===a.STATES.HYPER?(e.x+=e.hyperDirX*(o/1e3)*60,e.y+=e.hyperDirY*(o/1e3)*60,e.x=Math.max(e.radius,Math.min(a.ARENA_WIDTH-e.radius,e.x)),e.y=Math.max(e.radius,Math.min(a.ARENA_HEIGHT-e.radius,e.y))):(e.state===a.STATES.IDLE||e.state===a.STATES.MOVE||e.state===a.STATES.STONE)&&Q(t,e,o),e.state===a.STATES.SPIN&&(e.spinAngle+=360/a.SPIN_DURATION_MS*o,t.gameTime-e.spinLastDamageTime>=a.SPIN_TICK_MS&&(e.spinLastDamageTime=t.gameTime,t.enemies.forEach(n=>{if(c(e.x,e.y,n.x,n.y)<=a.SPIN_AOE_RADIUS){const i=M(e.atk,n.def,e.condition,a.SPIN_MULTIPLIER);n.hp-=i,n.hp<=0&&(t.enemiesDefeated++,e.energy=Math.min(a.ENERGY_MAX,e.energy+a.ENERGY_GAIN_PER_HIT))}}))),e.state===a.STATES.GIANT_SLAM&&e.stateTimer<=a.GIANT_SLAM_MS*.5&&!e.giantDamageDealt){e.giantDamageDealt=!0;const n=a.GIANT_MULTIPLIER;t.enemies.forEach(i=>{if(c(e.x,e.y,i.x,i.y)<=a.GIANT_AOE_RADIUS){const r=M(e.atk,i.def,e.condition,n);i.hp-=r,i.hp<=0&&(t.enemiesDefeated++,e.energy=Math.min(a.ENERGY_MAX,e.energy+a.ENERGY_GAIN_PER_HIT))}})}e.attackPhase==="active"&&!e.attackHitDealt&&(e.attackHitDealt=!0,t.enemies.forEach(n=>{if(c(e.x,e.y,n.x,n.y)<=a.ATTACK_RANGE+n.radius){const i=M(e.atk,n.def,e.condition,a.ATTACK_MULTIPLIER);n.hp-=i,n.hp<=0&&(t.enemiesDefeated++,e.energy=Math.min(a.ENERGY_MAX,e.energy+a.ENERGY_GAIN_PER_HIT))}}),e.clones.forEach(n=>{const i=t.enemies.reduce((r,T)=>{if(T.hp<=0)return r;const E=c(n.x,n.y,T.x,T.y);return!r||E<c(n.x,n.y,r.x,r.y)?T:r},null);if(i&&c(n.x,n.y,i.x,i.y)<50){const r=t.gameTime;if(r-n.lastAttackTime>500){const T=Math.floor(M(e.atk,i.def,e.condition,a.MULTIPLY_CLONE_DAMAGE_MULT));i.hp-=T,n.lastAttackTime=r,i.hp<=0&&t.enemiesDefeated++}}})),e.state===a.STATES.HYPER&&e.stateTimer<=50&&!e.hyperDamageDealt&&(e.hyperDamageDealt=!0,t.enemies.forEach(n=>{if(c(e.x,e.y,n.x,n.y)<=a.HYPER_AOE_RADIUS){const i=M(e.atk,n.def,e.condition,a.HYPER_MULTIPLIER);n.hp-=i,n.hp<=0&&(t.enemiesDefeated++,e.energy=Math.min(a.ENERGY_MAX,e.energy+a.ENERGY_GAIN_PER_HIT))}})),e.clones=e.clones.filter(n=>{if(n.lifetime-=o,n.lifetime<=0)return!1;const i=t.enemies.find(r=>r.hp>0&&c(n.x,n.y,r.x,r.y)<150);if(i){const r=i.x-n.x,T=i.y-n.y,E=Math.hypot(r,T)||1,s=3*(o/1e3)*60;n.x+=r/E*Math.min(s,E),n.y+=T/E*Math.min(s,E)}return!0}),t.enemies.forEach(n=>v(n,e.x,e.y,o)),t.enemies.forEach(w),t.enemies=t.enemies.filter(n=>n.hp>0),t.enemies.forEach(n=>{if(U(e.x,e.y,e.radius,n.x,n.y,n.radius)&&n.damageCooldown<=0&&e.invulnerable<=0){const i=e.def*e.stoneDefBoost,r=M(n.atk,i,1,1);e.hp-=r,n.damageCooldown=a.ENEMY_DAMAGE_COOLDOWN_MS;const T=e.x-n.x,E=e.y-n.y,s=Math.hypot(T,E)||1;e.vx=T/s*a.PLAYER_KNOCKBACK,e.vy=E/s*a.PLAYER_KNOCKBACK,e.state=a.STATES.HITSTUN,e.stateTimer=a.HITSTUN_MS,e.invulnerable=a.HITSTUN_MS,t.screenShake=a.SCREEN_SHAKE_AMOUNT,t.hitFlash=a.HIT_FLASH_MS,e.hp<=0&&(t.phase="lost")}}),(e.vx!==0||e.vy!==0)&&(e.x+=e.vx*(o/1e3)*60,e.y+=e.vy*(o/1e3)*60,e.vx*=.85,e.vy*=.85,e.x=Math.max(e.radius,Math.min(a.ARENA_WIDTH-e.radius,e.x)),e.y=Math.max(e.radius,Math.min(a.ARENA_HEIGHT-e.radius,e.y))),J(e,o),t.gameTime+=o,e.energy<a.ENERGY_MAX&&(e.energy=Math.min(a.ENERGY_MAX,e.energy+a.ENERGY_DECAY_RATE*(o/1e3)*60))}function tt(t){const e=Math.random()*Math.PI*2,o=250+Math.random()*100,n=a.ARENA_WIDTH/2+Math.cos(e)*o,i=a.ARENA_HEIGHT/2+Math.sin(e)*o;t.enemies.push(Y(n,i))}function et(t){const e=t.canvas,o=t.player;e.addEventListener("pointerdown",n=>{n.preventDefault();const{x:i,y:r}=m(n,e),T=L(i,r,o.x,o.y,o.radius+10),E=performance.now();e.setPointerCapture(n.pointerId),g(t.gesture,i,r,o.x,o.y,o.radius,E);const s=K(t.gesture,i,r,T,E);if(s.type!=="none"){S(t,s);return}const l=b(t.gesture,i,r,T,E);if(l.type!=="none"){S(t,l);return}T&&P(o)?S(t,{type:"attack"}):S(t,{type:"move",x:i,y:r})},{passive:!1}),e.addEventListener("pointermove",n=>{const{x:i,y:r}=m(n,e),{spin:T,giantCharge:E}=F(t.gesture,i,r,o.x,o.y,o.radius,performance.now());T&&S(t,{type:"spin"},performance.now()),E&&S(t,{type:"giant_charge"},performance.now())},{passive:!0}),e.addEventListener("pointerup",n=>{const{x:i,y:r}=m(n,e),T=L(i,r,o.x,o.y,o.radius+10),E=performance.now();t.gesture.pointerDownOnChar&&t.player.state===a.STATES.GIANT_CHARGE&&S(t,{type:"giant_release"}),W(t.gesture,i,r,T,E),X(t.gesture)},{passive:!0}),e.addEventListener("contextmenu",n=>n.preventDefault(),{passive:!1})}let O=0;function H(t,e){const o=e-t.lastTime;for(t.lastTime=e,t.accumulator+=Math.min(o,250);t.accumulator>=D&&t.phase==="playing";)Z(t),t.accumulator-=D,t.gameTime-O>=a.ENEMY_SPAWN_INTERVAL_MS&&(tt(t),O=t.gameTime),(t.gameTime>=a.SURVIVAL_TIME_MS||t.enemiesDefeated>=a.ENEMIES_TO_DEFEAT)&&(t.phase="won");t.screenShake>0&&(t.screenShake-=2),t.hitFlash>0&&(t.hitFlash-=16),B(t),$(t),requestAnimationFrame(n=>H(t,n))}function p(){const t=document.getElementById("gameCanvas");if(!t){console.error("Canvas not found");return}const e=j(t);et(e),requestAnimationFrame(o=>H(e,o))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",p):p();
//# sourceMappingURL=index-C9eEqdC_.js.map
