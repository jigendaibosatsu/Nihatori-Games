<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>Grow å³¶ â€“ Nihatori Games</title>
  <link rel="stylesheet" href="/styles.css" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body.game-page {
      padding-top: 48px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: "MS PGothic", "Yu Gothic", sans-serif;
      background: linear-gradient(180deg, #87ceeb 0%, #e0f6ff 40%, #90ee90 100%);
      color: #1e3a2f;
    }
    .grow-wrap {
      width: 100%;
      max-width: 480px;
      padding: 10px;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .grow-title {
      font-size: 1.1rem;
      text-align: center;
      font-weight: bold;
      color: #0d9488;
    }
    .grow-sub {
      font-size: 11px;
      text-align: center;
      color: #334155;
      line-height: 1.5;
      margin-bottom: 2px;
    }
    .grow-stage {
      flex: 1;
      min-height: 200px;
      border-radius: 12px;
      border: 2px solid #0d9488;
      background: linear-gradient(180deg, #a7f3d0 0%, #6ee7b7 30%, #34d399 60%, #0d9488 100%);
      position: relative;
      overflow: hidden;
    }
    .grow-canvas {
      display: block;
      width: 100%;
      height: 100%;
      min-height: 220px;
    }
    .grow-items {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin-top: 8px;
    }
    .grow-btn {
      width: 64px;
      height: 64px;
      border-radius: 12px;
      border: 2px solid #0f766e;
      background: linear-gradient(180deg, #ccfbf1, #99f6e4);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: bold;
      color: #134e4a;
      -webkit-tap-highlight-color: transparent;
      transition: transform 0.1s, box-shadow 0.1s;
    }
    .grow-btn:hover { box-shadow: 0 4px 12px rgba(13,148,136,0.3); }
    .grow-btn:active { transform: scale(0.96); }
    .grow-btn.done {
      background: linear-gradient(180deg, #a7f3d0, #5eead4);
      border-color: #0d9488;
      color: #0f766e;
    }
    .grow-btn .icon { font-size: 20px; margin-bottom: 2px; }
    .grow-result {
      margin-top: 8px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 2px solid #0d9488;
      background: rgba(255,255,255,0.9);
      font-size: 12px;
      line-height: 1.6;
      color: #134e4a;
      display: none;
    }
    .grow-result.visible { display: block; }
    .grow-result h3 { font-size: 13px; margin-bottom: 6px; color: #0f766e; }
    .grow-again {
      display: inline-block;
      margin-top: 8px;
      padding: 8px 16px;
      border-radius: 999px;
      border: 2px solid #0d9488;
      background: linear-gradient(180deg, #2dd4bf, #14b8a6);
      color: #fff;
      font-size: 12px;
      font-weight: bold;
      cursor: pointer;
    }
    .grow-again:hover { opacity: 0.95; }
    .grow-back {
      display: inline-block;
      margin-top: 8px;
      font-size: 12px;
      color: #0f766e;
      text-decoration: none;
    }
  </style>
</head>
<body class="game-page">
  <div id="site-header"></div>

  <div class="grow-wrap">
    <h1 class="grow-title">Grow å³¶</h1>
    <p class="grow-sub">
      ä¸‹ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’ã€Œã‚¯ãƒªãƒƒã‚¯ã™ã‚‹é †ç•ªã€ã§ä¸–ç•ŒãŒå¤‰ã‚ã‚‹ã‚ˆã€‚<br />
      å…¨éƒ¨6ã¤ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰çµæœãŒå‡ºã‚‹ã€‚é•ã†é †ç•ªã‚’è©¦ã—ã¦ã¿ã‚ˆã†ã€‚
    </p>

    <div class="grow-stage">
      <canvas id="growCanvas" class="grow-canvas" width="460" height="240"></canvas>
    </div>

    <div class="grow-items" id="growItems">
      <button type="button" class="grow-btn" data-id="tree" title="æœ¨"><span class="icon">ğŸŒ²</span>æœ¨</button>
      <button type="button" class="grow-btn" data-id="water" title="æ°´"><span class="icon">ğŸ’§</span>æ°´</button>
      <button type="button" class="grow-btn" data-id="fire" title="ç«"><span class="icon">ğŸ”¥</span>ç«</button>
      <button type="button" class="grow-btn" data-id="earth" title="åœŸ"><span class="icon">ğŸŸ«</span>åœŸ</button>
      <button type="button" class="grow-btn" data-id="person" title="äºº"><span class="icon">ğŸ§‘</span>äºº</button>
      <button type="button" class="grow-btn" data-id="house" title="å®¶"><span class="icon">ğŸ </span>å®¶</button>
    </div>

    <p class="grow-sub" id="growHint">ã‚¯ãƒªãƒƒã‚¯ã—ãŸé †ç•ªãŒã€Œè‚²ã¡æ–¹ã€ã«ãªã‚‹ã€‚ã„ã¾ 0 / 6 å€‹ã€‚</p>

    <div class="grow-result" id="growResult">
      <h3 id="growResultTitle">çµæœ</h3>
      <p id="growResultText"></p>
      <button type="button" class="grow-again" id="growAgain">ã‚‚ã†ä¸€åº¦ã€é †ç•ªã‚’å¤‰ãˆã¦éŠã¶</button>
    </div>

    <a href="/index.html" class="grow-back">â† ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</a>
  </div>

  <script src="/assets/header.js"></script>
  <script>
(function () {
  'use strict';

  var ITEMS = ['tree', 'water', 'fire', 'earth', 'person', 'house'];
  var LABELS = { tree: 'æœ¨', water: 'æ°´', fire: 'ç«', earth: 'åœŸ', person: 'äºº', house: 'å®¶' };

  var state = {
    order: [],       // ã‚¯ãƒªãƒƒã‚¯é † â†’ [id, id, ...]
    levels: {},      // id â†’ 1..6 (é †ç•ªã§ã¤ã„ãŸãƒ¬ãƒ™ãƒ«)
    done: false
  };

  var canvas = document.getElementById('growCanvas');
  var ctx = canvas.getContext('2d');
  var cw = canvas.width;
  var ch = canvas.height;

  function getLevel(id) {
    return state.levels[id] || 0;
  }

  function draw() {
    ctx.clearRect(0, 0, cw, ch);

    // ç©º
    ctx.fillStyle = '#87ceeb';
    ctx.fillRect(0, 0, cw, ch * 0.4);
    // å³¶ã®åœŸå°
    ctx.fillStyle = '#8B4513';
    ctx.beginPath();
    ctx.ellipse(cw / 2, ch * 0.75, cw * 0.45, ch * 0.25, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#228B22';
    ctx.beginPath();
    ctx.ellipse(cw / 2, ch * 0.72, cw * 0.42, ch * 0.22, 0, 0, Math.PI * 2);
    ctx.fill();

    var scale = function (id) {
      var lv = getLevel(id);
      return lv <= 0 ? 0 : 0.2 + (lv / 6) * 0.8;
    };

    // é…ç½®ï¼ˆå·¦ã‹ã‚‰å³ï¼‰
    var positions = [
      { id: 'tree',  x: cw * 0.18, y: ch * 0.65 },
      { id: 'water', x: cw * 0.32, y: ch * 0.72 },
      { id: 'fire',  x: cw * 0.48, y: ch * 0.68 },
      { id: 'earth', x: cw * 0.62, y: ch * 0.72 },
      { id: 'person', x: cw * 0.76, y: ch * 0.68 },
      { id: 'house', x: cw * 0.90, y: ch * 0.62 }
    ];

    positions.forEach(function (p) {
      var s = scale(p.id);
      if (s <= 0) return;
      var x = p.x;
      var y = p.y;

      switch (p.id) {
        case 'tree':
          ctx.fillStyle = '#228B22';
          ctx.beginPath();
          ctx.arc(x, y - 12 * s, 14 * s, 0, Math.PI * 2);
          ctx.fill();
          ctx.fillStyle = '#8B4513';
          ctx.fillRect(x - 3 * s, y, 6 * s, 18 * s);
          break;
        case 'water':
          ctx.fillStyle = 'rgba(30,144,255,0.8)';
          ctx.beginPath();
          ctx.ellipse(x, y, 12 * s, 8 * s, 0, 0, Math.PI * 2);
          ctx.fill();
          break;
        case 'fire':
          ctx.fillStyle = '#ff6b35';
          ctx.beginPath();
          ctx.moveTo(x, y - 15 * s);
          ctx.lineTo(x - 8 * s, y + 5 * s);
          ctx.lineTo(x + 8 * s, y + 5 * s);
          ctx.closePath();
          ctx.fill();
          ctx.fillStyle = '#ffdd00';
          ctx.beginPath();
          ctx.arc(x, y - 5 * s, 5 * s, 0, Math.PI * 2);
          ctx.fill();
          break;
        case 'earth':
          ctx.fillStyle = '#8B4513';
          ctx.beginPath();
          ctx.arc(x, y, 14 * s, 0, Math.PI * 2);
          ctx.fill();
          ctx.strokeStyle = '#654321';
          ctx.lineWidth = 2;
          ctx.stroke();
          break;
        case 'person':
          ctx.fillStyle = '#ffdbac';
          ctx.beginPath();
          ctx.arc(x, y - 10 * s, 8 * s, 0, Math.PI * 2);
          ctx.fill();
          ctx.fillStyle = '#1a1a1a';
          ctx.fillRect(x - 6 * s, y, 12 * s, 14 * s);
          ctx.fillRect(x - 4 * s, y + 14 * s, 5 * s, 12 * s);
          ctx.fillRect(x + 2 * s, y + 14 * s, 5 * s, 12 * s);
          break;
        case 'house':
          ctx.fillStyle = '#cd853f';
          ctx.fillRect(x - 12 * s, y - 8 * s, 24 * s, 20 * s);
          ctx.fillStyle = '#8b0000';
          ctx.beginPath();
          ctx.moveTo(x - 14 * s, y - 8 * s);
          ctx.lineTo(x, y - 22 * s);
          ctx.lineTo(x + 14 * s, y - 8 * s);
          ctx.closePath();
          ctx.fill();
          ctx.fillStyle = '#333';
          ctx.fillRect(x - 4 * s, y + 2 * s, 8 * s, 10 * s);
          break;
      }
    });
  }

  function updateHint() {
    var n = state.order.length;
    document.getElementById('growHint').textContent =
      'ã‚¯ãƒªãƒƒã‚¯ã—ãŸé †ç•ªãŒã€Œè‚²ã¡æ–¹ã€ã«ãªã‚‹ã€‚ã„ã¾ ' + n + ' / 6 å€‹ã€‚';
  }

  var ICONS = { tree: 'ğŸŒ²', water: 'ğŸ’§', fire: 'ğŸ”¥', earth: 'ğŸŸ«', person: 'ğŸ§‘', house: 'ğŸ ' };

  function updateButtons() {
    ITEMS.forEach(function (id) {
      var btn = document.querySelector('.grow-btn[data-id="' + id + '"]');
      if (!btn) return;
      var lv = getLevel(id);
      btn.classList.toggle('done', lv > 0);
      var icon = btn.querySelector('.icon');
      if (!icon) {
        icon = document.createElement('span');
        icon.className = 'icon';
        btn.insertBefore(icon, btn.firstChild);
      }
      icon.textContent = ICONS[id];
      var text = (lv > 0 ? 'Lv.' + lv + ' ' : '') + LABELS[id];
      var next = icon.nextSibling;
      if (next && next.nodeType === 3) {
        next.textContent = text;
      } else {
        var t = document.createTextNode(text);
        if (next) btn.insertBefore(t, next);
        else btn.appendChild(t);
      }
    });
  }

  function getEnding() {
    var tree = getLevel('tree');
    var water = getLevel('water');
    var fire = getLevel('fire');
    var earth = getLevel('earth');
    var person = getLevel('person');
    var house = getLevel('house');

    if (fire >= 5 && water <= 2) {
      return { title: 'ç‚ã®å³¶', text: 'ç«ãŒå¼·ãã€å³¶ã¯å°‘ã—ç„¦ã’ã¦ã„ã‚‹ã€‚ã§ã‚‚æ¸©ã‹ã„ã€‚' };
    }
    if (water >= 5 && fire <= 2) {
      return { title: 'æ½¤ã„ã®å³¶', text: 'æ°´ãŒè±Šã‹ã§ã€æœ¨ã‚‚äººã‚‚å…ƒæ°—ã€‚ç·‘ãŒã„ã£ã±ã„ã€‚' };
    }
    if (tree >= 5) {
      return { title: 'æ£®ã®å³¶', text: 'æœ¨ãŒå¤§ããè‚²ã£ãŸã€‚æ£®ã®ä¸­ã«å®¶ã¨äººãŒã„ã‚‹ã€‚' };
    }
    if (house >= 5 && person >= 4) {
      return { title: 'ã«ãã‚ã„ã®å³¶', text: 'å®¶ã¨äººãŒã—ã£ã‹ã‚Šè‚²ã£ãŸã€‚æš®ã‚‰ã—ãŒæˆã‚Šç«‹ã£ã¦ã„ã‚‹ã€‚' };
    }
    if (earth >= 5) {
      return { title: 'å¤§åœ°ã®å³¶', text: 'åœŸãŒè±Šã‹ã€‚ã“ã‚Œã‹ã‚‰ä½•ã§ã‚‚è‚²ã¡ãã†ã€‚' };
    }
    if (person >= 5) {
      return { title: 'äººã®å³¶', text: 'äººãŒä¸»å½¹ã€‚ã¿ã‚“ãªã§å³¶ã‚’è€•ã—ã¦ã„ã‚‹ã€‚' };
    }
    var top = Math.max(tree, water, fire, earth, person, house);
    if (top <= 2) {
      return { title: 'ã®ã‚“ã³ã‚Šå³¶', text: 'ã©ã‚Œã‚‚ã»ã©ã»ã©ã€‚ã®ã‚“ã³ã‚Šã—ãŸå³¶ã«ãªã£ãŸã€‚' };
    }
    return { title: 'ãƒãƒ©ãƒ³ã‚¹ã®å³¶', text: 'ã„ã‚ã„ã‚ãŒç¨‹ã‚ˆãè‚²ã£ãŸã€‚ç©ã‚„ã‹ãªå³¶ã ã€‚' };
  }

  function finish() {
    state.done = true;
    var end = getEnding();
    document.getElementById('growResultTitle').textContent = end.title;
    document.getElementById('growResultText').textContent = end.text;
    document.getElementById('growResult').classList.add('visible');
    document.querySelectorAll('.grow-btn').forEach(function (b) { b.disabled = true; });
  }

  function onClick(e) {
    var btn = e.target.closest('.grow-btn');
    if (!btn || state.done) return;
    var id = btn.getAttribute('data-id');
    if (state.levels[id]) return;
    var nextOrder = state.order.length + 1;
    state.order.push(id);
    state.levels[id] = nextOrder;
    updateHint();
    updateButtons();
    draw();
    if (state.order.length >= 6) {
      finish();
    }
  }

  function reset() {
    state.order = [];
    state.levels = {};
    state.done = false;
    ITEMS.forEach(function (id) { state.levels[id] = 0; });
    document.getElementById('growResult').classList.remove('visible');
    document.querySelectorAll('.grow-btn').forEach(function (b) {
      b.disabled = false;
      b.classList.remove('done');
      b.innerHTML = '';
      var icon = document.createElement('span');
      icon.className = 'icon';
      icon.textContent = { tree: 'ğŸŒ²', water: 'ğŸ’§', fire: 'ğŸ”¥', earth: 'ğŸŸ«', person: 'ğŸ§‘', house: 'ğŸ ' }[id];
      b.appendChild(icon);
      b.appendChild(document.createTextNode(LABELS[b.getAttribute('data-id')]));
    });
    updateHint();
    draw();
  }

  document.getElementById('growItems').addEventListener('click', onClick);
  document.getElementById('growAgain').addEventListener('click', reset);

  reset();
})();
  </script>
</body>
</html>
